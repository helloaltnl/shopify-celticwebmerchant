{%- comment -%}
  Main Password Page
  Combined header, content and footer for password-protected storefront
{%- endcomment -%}

{%- liquid
  assign bg_color = section.settings.background_color | default: '#0f1f38'
  assign text_color = section.settings.text_color | default: '#ffffff'
  assign overlay_color = section.settings.overlay_color | default: '#000000'
  assign overlay_opacity = section.settings.overlay_opacity | default: 50
-%}

<div id="shopify-section-{{ section.id }}" class="main-password">
  {%- if section.settings.background_image != blank -%}
    <div class="main-password__background">
      {{- section.settings.background_image | image_url: width: 1920 | image_tag: 
        class: 'main-password__background-image',
        loading: 'eager',
        sizes: '100vw',
        widths: '375, 750, 1100, 1500, 1920'
      -}}
    </div>
  {%- endif -%}

  <div class="main-password__overlay"></div>

  <div class="main-password__container">
    {%- comment -%} Header {%- endcomment -%}
    <header class="main-password__header">
      {%- if settings.logo != blank -%}
        {%- assign logo_alt = settings.logo.alt | default: shop.name | escape -%}
        <a href="{{ routes.root_url }}" class="main-password__logo-link">
          {{- settings.logo | image_url: width: 400 | image_tag:
            class: 'main-password__logo',
            loading: 'eager',
            width: section.settings.logo_width,
            alt: logo_alt
          -}}
        </a>
      {%- else -%}
        <a href="{{ routes.root_url }}" class="main-password__shop-name">
          {{- shop.name -}}
        </a>
      {%- endif -%}
    </header>

    {%- comment -%} Main Content {%- endcomment -%}
    <main class="main-password__content">
      {%- if section.settings.heading != blank -%}
        <h1 class="main-password__heading">{{ section.settings.heading }}</h1>
      {%- endif -%}

      {%- if shop.password_message != blank -%}
        <div class="main-password__message">
          {{ shop.password_message }}
        </div>
      {%- endif -%}

      {%- if section.settings.show_newsletter -%}
        <div class="main-password__newsletter">
          {%- form 'customer', class: 'main-password__newsletter-form' -%}
            <input type="hidden" name="contact[tags]" value="newsletter">
            <div class="main-password__newsletter-field">
              <input
                type="email"
                name="contact[email]"
                id="NewsletterEmail"
                class="main-password__newsletter-input"
                placeholder="{{ 'general.password_page.email_placeholder' | t | default: 'Email address' }}"
                required
                autocomplete="email"
              >
              <button type="submit" class="main-password__newsletter-button">
                <span>{{ section.settings.newsletter_button_text | default: 'Notify me' }}</span>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                  <polyline points="12 5 19 12 12 19"></polyline>
                </svg>
              </button>
            </div>
            {%- if form.posted_successfully? -%}
              <p class="main-password__newsletter-success">
                {{ 'general.password_page.email_success' | t | default: 'Thanks! We will notify you when we launch.' }}
              </p>
            {%- endif -%}
          {%- endform -%}
        </div>
      {%- endif -%}
    </main>

    {%- comment -%} Footer {%- endcomment -%}
    <footer class="main-password__footer">
      {%- comment -%} Password Login Button {%- endcomment -%}
      <button type="button" class="main-password__login-toggle" data-password-toggle>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
          <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
        </svg>
        <span>{{ 'general.password_page.login_password_button' | t | default: 'Enter using password' }}</span>
      </button>

      {%- comment -%} Social Links {%- endcomment -%}
      {%- if section.settings.show_social -%}
        <ul class="main-password__social">
          {%- if settings.social_facebook_link != blank -%}
            <li>
              <a href="{{ settings.social_facebook_link }}" target="_blank" rel="noopener" aria-label="Facebook">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg>
              </a>
            </li>
          {%- endif -%}
          {%- if settings.social_instagram_link != blank -%}
            <li>
              <a href="{{ settings.social_instagram_link }}" target="_blank" rel="noopener" aria-label="Instagram">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>
              </a>
            </li>
          {%- endif -%}
          {%- if settings.social_twitter_link != blank -%}
            <li>
              <a href="{{ settings.social_twitter_link }}" target="_blank" rel="noopener" aria-label="Twitter">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path></svg>
              </a>
            </li>
          {%- endif -%}
          {%- if settings.social_youtube_link != blank -%}
            <li>
              <a href="{{ settings.social_youtube_link }}" target="_blank" rel="noopener" aria-label="YouTube">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"></path></svg>
              </a>
            </li>
          {%- endif -%}
          {%- if settings.social_tiktok_link != blank -%}
            <li>
              <a href="{{ settings.social_tiktok_link }}" target="_blank" rel="noopener" aria-label="TikTok">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"></path></svg>
              </a>
            </li>
          {%- endif -%}
          {%- if settings.social_pinterest_link != blank -%}
            <li>
              <a href="{{ settings.social_pinterest_link }}" target="_blank" rel="noopener" aria-label="Pinterest">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.373 0 0 5.372 0 12c0 5.084 3.163 9.426 7.627 11.174-.105-.949-.2-2.405.042-3.441.218-.937 1.407-5.965 1.407-5.965s-.359-.719-.359-1.782c0-1.668.967-2.914 2.171-2.914 1.023 0 1.518.769 1.518 1.69 0 1.029-.655 2.568-.994 3.995-.283 1.194.599 2.169 1.777 2.169 2.133 0 3.772-2.249 3.772-5.495 0-2.873-2.064-4.882-5.012-4.882-3.414 0-5.418 2.561-5.418 5.207 0 1.031.397 2.138.893 2.738.098.119.112.224.083.345l-.333 1.36c-.053.22-.174.267-.402.161-1.499-.698-2.436-2.889-2.436-4.649 0-3.785 2.75-7.262 7.929-7.262 4.163 0 7.398 2.967 7.398 6.931 0 4.136-2.607 7.464-6.227 7.464-1.216 0-2.359-.632-2.75-1.378l-.748 2.853c-.271 1.043-1.002 2.35-1.492 3.146C9.57 23.812 10.763 24 12 24c6.627 0 12-5.373 12-12 0-6.628-5.373-12-12-12z"></path></svg>
              </a>
            </li>
          {%- endif -%}
        </ul>
      {%- endif -%}

      <p class="main-password__copyright">
        &copy; {{ 'now' | date: '%Y' }} {{ shop.name }}
      </p>
    </footer>
  </div>

  {%- comment -%} Password Modal {%- endcomment -%}
  <div class="main-password__modal" data-password-modal hidden>
    <div class="main-password__modal-overlay" data-password-close></div>
    <div class="main-password__modal-content" role="dialog" aria-modal="true" aria-labelledby="PasswordModalTitle">
      <button type="button" class="main-password__modal-close" data-password-close aria-label="{{ 'accessibility.close' | t }}">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>

      <h2 id="PasswordModalTitle" class="main-password__modal-title">
        {{ 'general.password_page.login_form_heading' | t | default: 'Enter store using password' }}
      </h2>

      {%- form 'storefront_password', class: 'main-password__modal-form' -%}
        <div class="main-password__modal-field{% if form.errors %} main-password__modal-field--error{% endif %}">
          <label for="Password" class="main-password__modal-label">
            {{ 'general.password_page.login_form_password_label' | t | default: 'Password' }}
          </label>
          <input
            type="password"
            name="password"
            id="Password"
            class="main-password__modal-input"
            autocomplete="current-password"
            placeholder="{{ 'general.password_page.login_form_password_placeholder' | t | default: 'Your password' }}"
            {% if form.errors %}aria-invalid="true" aria-describedby="PasswordError"{% endif %}
          >
          {%- if form.errors -%}
            <p id="PasswordError" class="main-password__modal-error">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
              </svg>
              {{ 'general.password_page.login_form_error' | t | default: 'Wrong password!' }}
            </p>
          {%- endif -%}
        </div>

        <button type="submit" class="main-password__modal-submit">
          {{ 'general.password_page.login_form_submit' | t | default: 'Enter' }}
        </button>
      {%- endform -%}

      <p class="main-password__modal-admin">
        {{ 'general.password_page.admin_link_html' | t | default: 'Are you the store owner? <a href="/admin">Log in here</a>' }}
      </p>
    </div>
  </div>
</div>

<style>
  #shopify-section-{{ section.id }}.main-password {
    --password-bg: {{ bg_color }};
    --password-text: {{ text_color }};
    --password-overlay: {{ overlay_color }};
    --password-overlay-opacity: {{ overlay_opacity | divided_by: 100.0 }};

    position: relative;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    background-color: var(--password-bg);
    color: var(--password-text);
    overflow: hidden;
  }

  /* Background */
  #shopify-section-{{ section.id }} .main-password__background {
    position: absolute;
    inset: 0;
    z-index: 0;
  }

  #shopify-section-{{ section.id }} .main-password__background-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  #shopify-section-{{ section.id }} .main-password__overlay {
    position: absolute;
    inset: 0;
    z-index: 1;
    background-color: var(--password-overlay);
    opacity: var(--password-overlay-opacity);
  }

  /* Container */
  #shopify-section-{{ section.id }} .main-password__container {
    position: relative;
    z-index: 2;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    width: 100%;
    max-width: 40rem;
    margin: 0 auto;
    padding: 2rem;
  }

  /* Header */
  #shopify-section-{{ section.id }} .main-password__header {
    text-align: center;
    padding-bottom: 2rem;
  }

  #shopify-section-{{ section.id }} .main-password__logo {
    max-width: {{ section.settings.logo_width }}px;
    height: auto;
  }

  #shopify-section-{{ section.id }} .main-password__logo-link,
  #shopify-section-{{ section.id }} .main-password__shop-name {
    color: inherit;
    text-decoration: none;
  }

  #shopify-section-{{ section.id }} .main-password__shop-name {
    font-size: 1.5rem;
    font-weight: bold;
  }

  /* Content */
  #shopify-section-{{ section.id }} .main-password__content {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: 2rem 0;
  }

  #shopify-section-{{ section.id }} .main-password__heading {
    font-size: clamp(2rem, 5vw, 3.5rem);
    font-weight: bold;
    margin: 0 0 1rem;
    line-height: 1.2;
  }

  #shopify-section-{{ section.id }} .main-password__message {
    font-size: 1.125rem;
    opacity: 0.9;
    margin-bottom: 2rem;
    max-width: 30rem;
  }

  /* Newsletter */
  #shopify-section-{{ section.id }} .main-password__newsletter {
    width: 100%;
    max-width: 28rem;
  }

  #shopify-section-{{ section.id }} .main-password__newsletter-field {
    display: flex;
    gap: 0;
    border: 2px solid var(--password-text);
    border-radius: 0.25rem;
    overflow: hidden;
  }

  #shopify-section-{{ section.id }} .main-password__newsletter-input {
    flex: 1;
    padding: 0.875rem 1rem;
    border: none;
    background: transparent;
    color: inherit;
    font-size: 1rem;
  }

  #shopify-section-{{ section.id }} .main-password__newsletter-input::placeholder {
    color: inherit;
    opacity: 0.6;
  }

  #shopify-section-{{ section.id }} .main-password__newsletter-input:focus {
    outline: none;
  }

  #shopify-section-{{ section.id }} .main-password__newsletter-button {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.875rem 1.25rem;
    background: var(--password-text);
    color: var(--password-bg);
    border: none;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: opacity 0.2s;
  }

  #shopify-section-{{ section.id }} .main-password__newsletter-button:hover {
    opacity: 0.9;
  }

  #shopify-section-{{ section.id }} .main-password__newsletter-success {
    margin-top: 1rem;
    color: #22c55e;
    font-weight: 500;
  }

  /* Footer */
  #shopify-section-{{ section.id }} .main-password__footer {
    text-align: center;
    padding-top: 2rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
  }

  #shopify-section-{{ section.id }} .main-password__login-toggle {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: transparent;
    border: 1px solid currentColor;
    border-radius: 0.25rem;
    color: inherit;
    font-size: 0.875rem;
    cursor: pointer;
    transition: background-color 0.2s, color 0.2s;
  }

  #shopify-section-{{ section.id }} .main-password__login-toggle:hover {
    background: var(--password-text);
    color: var(--password-bg);
  }

  #shopify-section-{{ section.id }} .main-password__social {
    display: flex;
    gap: 1rem;
    list-style: none;
    padding: 0;
    margin: 0;
  }

  #shopify-section-{{ section.id }} .main-password__social a {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 50%;
    color: inherit;
    opacity: 0.8;
    transition: opacity 0.2s, transform 0.2s;
  }

  #shopify-section-{{ section.id }} .main-password__social a:hover {
    opacity: 1;
    transform: scale(1.1);
  }

  #shopify-section-{{ section.id }} .main-password__copyright {
    font-size: 0.75rem;
    opacity: 0.6;
    margin: 0;
  }

  /* Modal */
  #shopify-section-{{ section.id }} .main-password__modal {
    position: fixed;
    inset: 0;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
  }

  #shopify-section-{{ section.id }} .main-password__modal[hidden] {
    display: none;
  }

  #shopify-section-{{ section.id }} .main-password__modal-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.7);
    cursor: pointer;
  }

  #shopify-section-{{ section.id }} .main-password__modal-content {
    position: relative;
    width: 100%;
    max-width: 24rem;
    background: #ffffff;
    color: #111111;
    border-radius: 0.5rem;
    padding: 2rem;
  }

  #shopify-section-{{ section.id }} .main-password__modal-close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: transparent;
    border: none;
    color: inherit;
    cursor: pointer;
    padding: 0.25rem;
    opacity: 0.6;
    transition: opacity 0.2s;
  }

  #shopify-section-{{ section.id }} .main-password__modal-close:hover {
    opacity: 1;
  }

  #shopify-section-{{ section.id }} .main-password__modal-title {
    font-size: 1.25rem;
    font-weight: bold;
    margin: 0 0 1.5rem;
  }

  #shopify-section-{{ section.id }} .main-password__modal-field {
    margin-bottom: 1rem;
  }

  #shopify-section-{{ section.id }} .main-password__modal-label {
    display: block;
    font-size: 0.875rem;
    font-weight: 500;
    margin-bottom: 0.5rem;
  }

  #shopify-section-{{ section.id }} .main-password__modal-input {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 1px solid #d1d5db;
    border-radius: 0.25rem;
    font-size: 1rem;
    transition: border-color 0.2s;
  }

  #shopify-section-{{ section.id }} .main-password__modal-input:focus {
    outline: none;
    border-color: #111111;
  }

  #shopify-section-{{ section.id }} .main-password__modal-field--error .main-password__modal-input {
    border-color: #dc2626;
  }

  #shopify-section-{{ section.id }} .main-password__modal-error {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 0.5rem;
    color: #dc2626;
    font-size: 0.875rem;
  }

  #shopify-section-{{ section.id }} .main-password__modal-submit {
    width: 100%;
    padding: 0.875rem 1.5rem;
    background: #111111;
    color: #ffffff;
    border: none;
    border-radius: 0.25rem;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.2s;
  }

  #shopify-section-{{ section.id }} .main-password__modal-submit:hover {
    background: #333333;
  }

  #shopify-section-{{ section.id }} .main-password__modal-admin {
    margin-top: 1.5rem;
    font-size: 0.75rem;
    color: #6b7280;
    text-align: center;
  }

  #shopify-section-{{ section.id }} .main-password__modal-admin a {
    color: inherit;
    text-decoration: underline;
  }

  /* Mobile adjustments */
  @media (max-width: 640px) {
    #shopify-section-{{ section.id }} .main-password__container {
      padding: 1.5rem;
    }

    #shopify-section-{{ section.id }} .main-password__newsletter-button span {
      display: none;
    }

    #shopify-section-{{ section.id }} .main-password__newsletter-button {
      padding: 0.875rem 1rem;
    }
  }
</style>

<script>
  (function() {
    const section = document.getElementById('shopify-section-{{ section.id }}');
    if (!section) return;

    const modal = section.querySelector('[data-password-modal]');
    const toggleBtn = section.querySelector('[data-password-toggle]');
    const closeBtns = section.querySelectorAll('[data-password-close]');
    const passwordInput = modal?.querySelector('#Password');

    function openModal() {
      if (!modal) return;
      modal.hidden = false;
      document.body.style.overflow = 'hidden';
      passwordInput?.focus();
    }

    function closeModal() {
      if (!modal) return;
      modal.hidden = true;
      document.body.style.overflow = '';
      toggleBtn?.focus();
    }

    toggleBtn?.addEventListener('click', openModal);
    closeBtns.forEach(btn => btn.addEventListener('click', closeModal));

    modal?.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') closeModal();
    });

    // Auto-open modal if there was an error
    if (passwordInput?.getAttribute('aria-invalid') === 'true') {
      openModal();
    }
  })();
</script>

{% schema %}
{
  "name": "Password page",
  "tag": "section",
  "class": "main-password-section",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Opening soon"
    },
    {
      "type": "checkbox",
      "id": "show_newsletter",
      "label": "Show newsletter signup",
      "default": true
    },
    {
      "type": "text",
      "id": "newsletter_button_text",
      "label": "Newsletter button text",
      "default": "Notify me"
    },
    {
      "type": "checkbox",
      "id": "show_social",
      "label": "Show social links",
      "default": true,
      "info": "Configure social links in theme settings"
    },
    {
      "type": "header",
      "content": "Logo"
    },
    {
      "type": "range",
      "id": "logo_width",
      "label": "Logo width",
      "min": 50,
      "max": 300,
      "step": 10,
      "default": 150,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "Background"
    },
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "Background image"
    },
    {
      "type": "color",
      "id": "overlay_color",
      "label": "Overlay color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "label": "Overlay opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 50,
      "unit": "%"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background",
      "default": "#0f1f38"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Howto"
    },
    {
      "type": "paragraph",
      "content": "Displayed when store is password protected. Set password message in Online Store > Preferences."
    }
  ]
}
{% endschema %}
