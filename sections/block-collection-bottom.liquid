{% comment %}
  ============================================================================
  BLOCK-COLLECTION-BOTTOM
  ============================================================================
  SEO text section for collections with title and description.

  FEATURES:
  - Collection title (configurable heading level)
  - Collection description (rich text)
  - Width alignment options
  - Color customization

  DEPENDENCIES:
  - None
  ============================================================================
{% endcomment %}

{%- if collection.description != blank or section.settings.show_title -%}
<div class="block-collection-bottom__content {{ section.settings.width }}">
	{%- if section.settings.show_title -%}
		<{{ section.settings.heading_tag }} class="block-collection-bottom__title">
			{{ collection.title | escape }}
		</{{ section.settings.heading_tag }}>
	{%- endif -%}

	{%- if collection.description != blank -%}
		<div class="block-collection-bottom__description rte">
			{{ collection.description 
				| replace: '<br>', ''
				| replace: '<br/>', ''
				| replace: '<br />', ''
				| replace: '<p></p>', ''
				| replace: '<p> </p>', ''
				| replace: '<p>  </p>', ''
				| replace: '<p>&nbsp;</p>', ''
			}}
		</div>
	{%- endif -%}
</div>
{%- endif -%}

{% style %}
	.block-collection-bottom {
		background-color: {{ section.settings.background_color }};
		color: {{ section.settings.text_color }};
		padding-top: 4em;
		padding-bottom: 4em;
	}

	.block-collection-bottom__content {
		text-align: {{ section.settings.text_align }};
	}

	.block-collection-bottom__title {
		font-family: var(--theme-font-family-serif);
		font-size: clamp(1.6em, 4vw, 2em);
		font-weight: 400;
		line-height: 1.2;
		letter-spacing: var(--theme-letter-spacing);
		margin: 0 0 0.75em 0;
	}

	.block-collection-bottom__description {
		line-height: 1.6;
		letter-spacing: var(--theme-letter-spacing);
	}

	/* Rich text styling */
	.block-collection-bottom__description.rte h1,
	.block-collection-bottom__description.rte h2,
	.block-collection-bottom__description.rte h3,
	.block-collection-bottom__description.rte h4,
	.block-collection-bottom__description.rte h5,
	.block-collection-bottom__description.rte h6 {
		font-family: var(--theme-font-family-serif);
		font-weight: 500;
		margin-top: 1.5em;
		margin-bottom: 0.5em;
	}

	/* Remove bold from headings (editors often wrap text in <strong>) */
	.block-collection-bottom__description.rte h1 strong,
	.block-collection-bottom__description.rte h2 strong,
	.block-collection-bottom__description.rte h3 strong,
	.block-collection-bottom__description.rte h4 strong,
	.block-collection-bottom__description.rte h5 strong,
	.block-collection-bottom__description.rte h6 strong {
		font-weight: inherit;
	}

	.block-collection-bottom__description.rte h1:first-child,
	.block-collection-bottom__description.rte h2:first-child,
	.block-collection-bottom__description.rte h3:first-child {
		margin-top: 0;
	}

	.block-collection-bottom__description.rte p {
		margin-bottom: 1em;
	}

	.block-collection-bottom__description.rte p:last-child {
		margin-bottom: 0;
	}
	
	.block-collection-bottom__description.rte p:empty {
		display: none;
	}

	.block-collection-bottom__description.rte ul,
	.block-collection-bottom__description.rte ol {
		margin: 1em 0;
		padding-left: 1.5em;
		list-style: revert;
	}

	.block-collection-bottom__description.rte li {
		margin-bottom: 0.25em;
	}

	.block-collection-bottom__description.rte a {
		color: var(--theme-color-blue);
		text-decoration: underline;
	}

	.block-collection-bottom__description.rte a:hover {
		text-decoration: none;
	}

	.block-collection-bottom__description.rte img {
		max-width: 100%;
		height: auto;
		margin: 1em 0;
	}

	.block-collection-bottom__description.rte table {
		width: 100%;
		margin: 1em 0;
		border-collapse: collapse;
	}

	.block-collection-bottom__description.rte th,
	.block-collection-bottom__description.rte td {
		padding: 0.5em;
		border: 1px solid var(--theme-color-grey);
		text-align: left;
	}

	.block-collection-bottom__description.rte th {
		background-color: var(--theme-color-grey);
		font-weight: 600;
	}
{% endstyle %}

<script>
(function() {
	const rte = document.querySelector('.block-collection-bottom__description.rte');
	if (!rte) return;
	rte.querySelectorAll('p').forEach(p => {
		if (!p.textContent.trim()) p.remove();
	});
})();
</script>

{% schema %}
{
	"name": "Collection bottom",
	"tag": "section",
	"class": "block-collection-bottom",
	"enabled_on": {
		"templates": ["collection"]
	},
	"settings": [
		{
			"type": "header",
			"content": "Content"
		},
		{
			"type": "checkbox",
			"id": "show_title",
			"label": "Show collection title",
			"default": false
		},
		{
			"type": "select",
			"id": "heading_tag",
			"label": "Heading tag",
			"options": [
				{ "value": "h1", "label": "H1" },
				{ "value": "h2", "label": "H2" },
				{ "value": "h3", "label": "H3" }
			],
			"default": "h2"
		},
		{
			"type": "header",
			"content": "Layout"
		},
		{
			"type": "select",
			"id": "width",
			"label": "Width",
			"options": [
				{ "value": "alignsmall", "label": "Narrow" },
				{ "value": "align", "label": "Regular" },
				{ "value": "alignwide", "label": "Wide" },
				{ "value": "alignfull", "label": "Full" }
			],
			"default": "alignsmall"
		},
		{
			"type": "select",
			"id": "text_align",
			"label": "Text alignment",
			"options": [
				{ "value": "left", "label": "Left" },
				{ "value": "center", "label": "Center" },
				{ "value": "right", "label": "Right" }
			],
			"default": "center"
		},
		{
			"type": "header",
			"content": "Colors"
		},
		{
			"type": "color",
			"id": "background_color",
			"label": "Background",
			"default": "#ffffff"
		},
		{
			"type": "color",
			"id": "text_color",
			"label": "Text",
			"default": "#111111"
		},
		{
			"type": "header",
			"content": "Howto"
		},
		{
			"type": "paragraph",
			"content": "Displays the collection description for SEO purposes. The description is managed in the collection settings."
		}
	],
	"presets": [
		{
			"name": "Bottom",
			"category": "Collection"
		}
	]
}
{% endschema %}
