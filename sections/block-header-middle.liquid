<div class="block-header-middle__content {{ section.settings.width }}">
	<button 
		type="button" 
		class="block-header-middle__menu-toggle" 
		aria-label="{{ 'accessibility.menu_open' | t }}"
		data-drawer-trigger="mobile-nav"
	>
		{% render 'html-theme-icons', icon: 'hamburger', size: 24 %}
	</button>

	<figure class="block-header-middle__logo">
		<a href="{{ routes.root_url }}" title="{{ shop.name }}">
			{%- if settings.logo != blank -%}
				{%- assign logo_alt = settings.logo.alt | default: shop.name | escape -%}
				{%- assign logo_height = section.settings.logo_width | divided_by: settings.logo.aspect_ratio -%}
				{{ settings.logo | image_url: width: 400 | image_tag:
					class: 'block-header-middle__logo-image',
					width: section.settings.logo_width,
					height: logo_height,
					alt: logo_alt,
					loading: 'eager',
					fetchpriority: 'high'
				}}
			{%- else -%}
				<span class="block-header-middle__logo-text">{{ shop.name }}</span>
			{%- endif -%}
		</a>
	</figure>

	{%- if section.settings.menu_primary != blank or section.settings.menu_secondary != blank -%}
		<nav class="block-header-middle__nav">
			{%- if section.settings.menu_primary != blank -%}
				{%- assign menu_primary = linklists[section.settings.menu_primary] -%}
				{%- if menu_primary.links.size > 0 -%}
					<ul class="block-header-middle__menu">
						{%- for link in menu_primary.links -%}
							<li class="block-header-middle__menu-item{% if link.links.size > 0 %} has-dropdown{% endif %}">
								<a href="{{ link.url }}" {% if link.current %}aria-current="page"{% endif %}>
									{{ link.title }}
								</a>
								{%- if link.links.size > 0 -%}
									<ul class="block-header-middle__dropdown">
										{%- for child in link.links -%}
											<li>
												<a href="{{ child.url }}" {% if child.current %}aria-current="page"{% endif %}>
													{{ child.title }}
												</a>
											</li>
										{%- endfor -%}
									</ul>
								{%- endif -%}
							</li>
						{%- endfor -%}
					</ul>
				{%- endif -%}
			{%- endif -%}

			{%- if section.settings.menu_secondary != blank -%}
				{%- assign menu_secondary = linklists[section.settings.menu_secondary] -%}
				{%- if menu_secondary.links.size > 0 -%}
					<ul class="block-header-middle__menu block-header-middle__menu--secondary">
						{%- for link in menu_secondary.links -%}
							<li class="block-header-middle__menu-item">
								<a href="{{ link.url }}" class="is-highlight" {% if link.current %}aria-current="page"{% endif %}>
									{{ link.title }}
								</a>
							</li>
						{%- endfor -%}
					</ul>
				{%- endif -%}
			{%- endif -%}
		</nav>
	{%- endif -%}

	<nav class="block-header-middle__actions" aria-label="{{ 'accessibility.menu_user' | t }}">
		<ul class="block-header-middle__actions-list">
			{%- if section.settings.show_search -%}
				<li>
					{% render 'html-button-search', show_label: false %}
				</li>
			{%- endif -%}

			{%- if shop.customer_accounts_enabled and section.settings.show_account -%}
				<li>
					{%- liquid
						if customer
							assign account_url = routes.account_url
							assign account_label = 'customer.account' | t
						else
							if section.settings.login_return_url != blank
								assign account_url = routes.storefront_login_url | append: '&return_url=' | append: section.settings.login_return_url
							else
								assign account_url = routes.account_login_url
							endif
							assign account_label = 'customer.log_in' | t
						endif
					-%}
					<a 
						class="block-header-middle__action" 
						href="{{ account_url }}" 
						aria-label="{{ account_label }}"
					>
						<i class="block-header-middle__icon">
							{% render 'html-theme-icons', icon: 'account', size: 24 %}
						</i>
					</a>
				</li>
			{%- endif -%}

			{%- if section.settings.show_wishlist -%}
				<li>
					<a 
						class="block-header-middle__action th_wlc_position_relative" 
						href="/apps/wishlist"
						aria-label="{{ 'customer.wishlist' | t }}"
					>
						<i class="block-header-middle__icon">
							<span class="th_wlc_product_count"></span>
							{% render 'html-theme-icons', icon: 'heart', size: 24 %}
						</i>
					</a>
				</li>
			{%- endif -%}

			{%- if section.settings.show_cart -%}
				<li>
					{% render 'html-button-cart', show_count: true, show_label: false, open_drawer: true %}
				</li>
			{%- endif -%}
		</ul>
	</nav>
</div>

{% style %}
	.block-header-middle {
		background-color: {{ section.settings.background_color | default: '#2e130d' }};
		color: {{ section.settings.text_color | default: '#ffffff' }};
	}

	.block-header-middle__content {
		display: flex;
		flex-wrap: nowrap;
		flex-direction: row;
		justify-content: space-between;
		align-items: center;
		gap: 2em;
		height: var(--header-middle-height, 3.5em);
	}

	.block-header-middle__logo {
		flex: 0 0 auto;
		margin: 0;
		padding: 0;
	}

	.block-header-middle__logo a {
		display: block;
		text-decoration: none;
		color: inherit;
	}

	.block-header-middle__logo-image {
		display: block;
		width: auto;
		height: auto;
		max-width: min({{ section.settings.logo_width }}px, 8em);
		max-height: 2.5em;
		object-fit: contain;
	}

	.block-header-middle__logo-text {
		font-family: var(--theme-font-family-serif);
		font-size: 1.4em;
		font-weight: 500;
		white-space: nowrap;
	}

	.block-header-middle__nav {
		flex: 1 1 auto;
		display: flex;
		align-items: center;
		gap: 1.5em;
	}

	.block-header-middle__menu {
		display: flex;
		flex-wrap: nowrap;
		align-items: center;
		gap: 1em;
		list-style: none;
		margin: 0;
		padding: 0;
	}

	.block-header-middle__menu-item {
		position: relative;
	}

	.block-header-middle__menu-item > a {
		display: block;
		text-decoration: none;
		color: inherit;
		white-space: nowrap;
		padding: 0.2em 0;
	}

	.block-header-middle__menu-item > a:hover {
		opacity: 0.8;
	}

	.block-header-middle__menu-item > a.is-highlight {
		border-bottom: 3px solid var(--theme-color-orange);
	}

	.block-header-middle__dropdown {
		position: absolute;
		top: 100%;
		left: 0;
		z-index: var(--theme-z-dropdown);
		min-width: 180px;
		padding: 0.5em 0;
		margin: 0;
		list-style: none;
		background-color: var(--theme-color-white);
		color: var(--theme-color-brown);
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
		opacity: 0;
		visibility: hidden;
		transform: translateY(0.5em);
		transition: opacity var(--theme-transition-fast), transform var(--theme-transition-fast), visibility var(--theme-transition-fast);
	}

	.block-header-middle__menu-item.has-dropdown:hover > .block-header-middle__dropdown,
	.block-header-middle__menu-item.has-dropdown:focus-within > .block-header-middle__dropdown {
		opacity: 1;
		visibility: visible;
		transform: translateY(0);
	}

	.block-header-middle__dropdown li a {
		display: block;
		padding: 0.5em 1em;
		text-decoration: none;
		color: inherit;
		white-space: nowrap;
	}

	.block-header-middle__dropdown li a:hover {
		background-color: var(--theme-color-grey);
	}

	.block-header-middle__actions {
		flex: 0 0 auto;
	}

	.block-header-middle__actions-list {
		display: flex;
		flex-wrap: nowrap;
		align-items: center;
		gap: 0;
		list-style: none;
		margin: 0;
		padding: 0;
	}

	.block-header-middle__actions-list > li > a,
	.block-header-middle__actions-list > li > button,
	.block-header-middle__actions-list .button-search,
	.block-header-middle__actions-list .button-cart {
		display: flex;
		align-items: center;
		justify-content: center;
		width: 2.5em;
		height: 2.5em;
		padding: 0;
		color: inherit;
		text-decoration: none;
		transition: opacity var(--theme-transition-fast);
	}

	.block-header-middle__actions-list > li > a:hover,
	.block-header-middle__actions-list > li > button:hover,
	.block-header-middle__actions-list .button-search:hover,
	.block-header-middle__actions-list .button-cart:hover {
		opacity: 0.8;
	}

	.block-header-middle__actions-list svg {
		width: 1.5em;
		height: 1.5em;
	}

	.block-header-middle__actions-list .th_wlc_position_relative svg {
		width: 1.5em;
		height: 1.5em;
	}

	.block-header-middle__icon {
		position: relative;
		display: flex;
		align-items: center;
		justify-content: center;
		font-style: normal;
	}

	.block-header-middle__icon .th_wlc_product_count:not(:empty) {
		position: absolute;
		top: -0.4em;
		right: -0.4em;
		min-width: 1.2em;
		height: 1.2em;
		padding: 0 0.3em;
		font-size: 0.7em;
		line-height: 1.2em;
		text-align: center;
		background-color: var(--theme-color-orange);
		color: var(--theme-color-white);
		border-radius: var(--theme-radius-full);
	}

	.block-header-middle__menu-toggle {
		display: none;
		align-items: center;
		justify-content: center;
		width: 1.5em;
		height: 2.5em;
		padding: 0;
		border: none;
		background: none;
		color: inherit;
		cursor: pointer;
		flex-shrink: 0;
	}

	.block-header-middle__menu-toggle svg {
		width: 1.5em;
		height: 1.5em;
	}

	@media (max-width: 60em) {
		.block-header-middle__nav {
			display: none;
		}

		.block-header-middle__content {
			gap: 1em;
		}

		.block-header-middle__menu-toggle {
			display: flex;
		}

		.block-header-middle__logo {
			margin-right: auto;
		}
	}
{% endstyle %}

<script>
	document.addEventListener('DOMContentLoaded', function() {
		const toggleButton = document.querySelector('[data-mobile-nav-toggle]');
		if (toggleButton) {
			toggleButton.addEventListener('click', function() {
				document.dispatchEvent(new CustomEvent('mobile-nav:toggle'));
			});
		}
	});
</script>

{% schema %}
{
	"name": "Header middle",
	"tag": "section",
	"class": "block-header-middle",
	"limit": 1,
	"enabled_on": {
		"groups": ["header"]
	},
	"settings": [
		{
			"type": "header",
			"content": "Logo"
		},
		{
			"type": "range",
			"id": "logo_width",
			"label": "Logo width",
			"min": 50,
			"max": 300,
			"step": 10,
			"default": 130,
			"unit": "px"
		},
		{
			"type": "header",
			"content": "Navigation"
		},
		{
			"type": "link_list",
			"id": "menu_primary",
			"label": "Primary menu"
		},
		{
			"type": "link_list",
			"id": "menu_secondary",
			"label": "Secondary menu",
			"info": "Highlighted links (e.g. sale). Only top-level items shown."
		},
		{
			"type": "header",
			"content": "Actions"
		},
		{
			"type": "checkbox",
			"id": "show_search",
			"label": "Show search",
			"default": true
		},
		{
			"type": "checkbox",
			"id": "show_account",
			"label": "Show account",
			"default": true
		},
		{
			"type": "checkbox",
			"id": "show_wishlist",
			"label": "Show wishlist",
			"default": true
		},
		{
			"type": "checkbox",
			"id": "show_cart",
			"label": "Show cart",
			"default": true
		},
		{
			"type": "header",
			"content": "Misc"
		},
		{
			"type": "url",
			"id": "login_return_url",
			"label": "Login return URL",
			"info": "Redirect guests here after login"
		},
		{
			"type": "header",
			"content": "Layout"
		},
		{
			"type": "select",
			"id": "width",
			"label": "Width",
			"options": [
				{ "value": "is-align-narrow", "label": "Narrow" },
				{ "value": "is-align-small", "label": "Small" },
				{ "value": "is-align", "label": "Regular" },
				{ "value": "is-align-wide", "label": "Wide" },
				{ "value": "is-align-full", "label": "Full" }
			],
			"default": "is-align-wide"
		},
		{
			"type": "header",
			"content": "Colors"
		},
		{
			"type": "color",
			"id": "background_color",
			"label": "Background"
		},
		{
			"type": "color",
			"id": "text_color",
			"label": "Text"
		},
		{
			"type": "header",
			"content": "Howto"
		},
		{
			"type": "paragraph",
			"content": "Logo is set in Theme Settings. On mobile, navigation moves to drawer."
		}
	],
	"presets": [
		{
			"name": "Middle bar",
			"category": "Header"
		}
	]
}
{% endschema %}
