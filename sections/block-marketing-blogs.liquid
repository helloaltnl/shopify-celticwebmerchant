{%- comment -%}
============================================================================
BLOCK-MARKETING-BLOGS
============================================================================
Blog feed grid section showing selected blogs as cards.
Marketing block for use on any page.

FEATURES:
- Select specific blogs to display via blocks
- Show article count per blog
- Grid layout with blog cards
- Optional heading and subheading

DEPENDENCIES:
- html-theme-icons snippet (optional, for arrow)
============================================================================
{%- endcomment -%}

{%- liquid
	assign heading_text = section.settings.heading
	if heading_text == blank
		assign heading_text = 'collection.heading' | t
	endif
-%}

<div class="block-marketing-blogs__content {{ section.settings.width }}{% if section.settings.custom_class != blank %} {{ section.settings.custom_class }}{% endif %}">
	{%- if section.settings.show_header -%}
		<header class="block-marketing-blogs__header">
			<h2 class="block-marketing-blogs__title">{{ heading_text }}</h2>
			{%- if section.settings.subheading != blank -%}
				<p class="block-marketing-blogs__subheading">{{ section.settings.subheading }}</p>
			{%- endif -%}
		</header>
	{%- endif -%}

	{%- if section.blocks.size > 0 -%}
		<ul class="block-marketing-blogs__grid" style="--grid-columns: {{ section.settings.columns_desktop | default: 4 }}; --grid-columns-tablet: {{ section.settings.columns_tablet | default: 3 }}; --grid-columns-mobile: {{ section.settings.columns_mobile | default: 2 }};">
			{%- for block in section.blocks -%}
				{%- assign blog = block.settings.blog -%}
				{%- if blog != blank -%}
					{%- assign blog_image = blog.metafields.custom.featured_image -%}
					<li class="block-marketing-blogs__item" {{ block.shopify_attributes }}>
						<a href="{{ blog.url }}" class="block-marketing-blogs__card" style="--card-bg: {{ section.settings.card_background_color | default: '#ffffff' }}; --card-text: {{ section.settings.card_text_color | default: '#111111' }};">
							{%- if section.settings.show_image and blog_image -%}
								<figure class="block-marketing-blogs__image">
									{{ blog_image | image_url: width: 800 | image_tag:
										loading: 'lazy',
										widths: '400, 600, 800',
										sizes: '(max-width: 47.5em) 50vw, 25vw'
									}}
								</figure>
							{%- endif -%}
							<div class="block-marketing-blogs__info">
								<h3 class="block-marketing-blogs__name">{{ blog.title }}</h3>
								{%- if section.settings.show_article_count -%}
									<span class="block-marketing-blogs__count">
										{{ 'blog.articles_count' | t: count: blog.articles_count }}
									</span>
								{%- endif -%}
							</div>
						</a>
					</li>
				{%- endif -%}
			{%- endfor -%}
		</ul>
	{%- else -%}
		<p class="block-marketing-blogs__empty">{{ 'general.no_content' | t }}</p>
	{%- endif -%}
</div>

{% style %}
	#shopify-section-{{ section.id }}.block-marketing-blogs {
		background-color: {{ section.settings.background_color | default: '#f8f8f8' }};
		color: {{ section.settings.text_color | default: '#111111' }};
		padding-block: 3em;
	}

	#shopify-section-{{ section.id }} .block-marketing-blogs__header {
		margin-bottom: 2em;
		text-align: {{ section.settings.text_align | default: 'center' }};
	}

	.block-marketing-blogs__title {
		font-family: var(--theme-font-family-serif);
		font-size: clamp(1.6em, 4vw, 2em);
		font-weight: 400;
		margin: 0;
	}

	.block-marketing-blogs__subheading {
		margin: 0.5em 0 0;
		opacity: 0.8;
	}

	.block-marketing-blogs__grid {
		display: grid;
		grid-template-columns: repeat(var(--grid-columns, 4), 1fr);
		gap: 0.5em;
		list-style: none;
		margin: 0;
		padding: 0;
	}

	.block-marketing-blogs__item {
		display: flex;
		min-width: 0;
	}

	.block-marketing-blogs__card {
		display: flex;
		flex-direction: column;
		width: 100%;
		text-decoration: none;
		color: var(--card-text, inherit);
		background-color: var(--card-bg, #fff);
		transition: transform 150ms ease, box-shadow 150ms ease;
	}

	.block-marketing-blogs__card:hover {
		transform: translateY(-2px);
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
	}

	#shopify-section-{{ section.id }} .block-marketing-blogs__image {
		margin: 0;
		aspect-ratio: {{ section.settings.image_ratio | replace: 'portrait', '2/3' | replace: 'landscape', '3/2' | replace: 'square', '1/1' | replace: 'adapt', 'auto' }};
		overflow: hidden;
	}

	.block-marketing-blogs__image img {
		width: 100%;
		height: 100%;
		object-fit: cover;
	}

	.block-marketing-blogs__info {
		padding: 1em;
	}

	.block-marketing-blogs__name {
		font-family: var(--theme-font-family-serif);
		font-size: 1.1em;
		font-weight: 500;
		margin: 0;
	}

	.block-marketing-blogs__count {
		display: block;
		margin-top: 0.25em;
		font-size: 0.875em;
		opacity: 0.7;
	}

	.block-marketing-blogs__empty {
		text-align: center;
		opacity: 0.6;
		padding: 3em 1em;
	}

	@media (max-width: 64em) {
		.block-marketing-blogs__grid {
			grid-template-columns: repeat(var(--grid-columns-tablet, 3), 1fr);
		}
	}

	@media (max-width: 47.5em) {
		.block-marketing-blogs__grid {
			grid-template-columns: repeat(var(--grid-columns-mobile, 2), 1fr);
		}
	}
{% endstyle %}

{% schema %}
{
	"name": "Blogs",
	"tag": "section",
	"class": "block-marketing-blogs",
	"settings": [
		{
			"type": "header",
			"content": "Content"
		},
		{
			"type": "checkbox",
			"id": "show_header",
			"label": "Show header",
			"default": true
		},
		{
			"type": "text",
			"id": "heading",
			"label": "Heading",
			"info": "Leave empty to use locale default"
		},
		{
			"type": "text",
			"id": "subheading",
			"label": "Subheading"
		},
		{
			"type": "header",
			"content": "Blog card"
		},
		{
			"type": "checkbox",
			"id": "show_image",
			"label": "Show image",
			"default": true
		},
		{
			"type": "select",
			"id": "image_ratio",
			"label": "Image ratio",
			"options": [
				{ "value": "adapt", "label": "Adapt" },
				{ "value": "square", "label": "Square (1:1)" },
				{ "value": "portrait", "label": "Portrait (2:3)" },
				{ "value": "landscape", "label": "Landscape (3:2)" }
			],
			"default": "landscape"
		},
		{
			"type": "checkbox",
			"id": "show_article_count",
			"label": "Show article count",
			"default": true
		},
		{
			"type": "header",
			"content": "Layout"
		},
		{
			"type": "select",
			"id": "width",
			"label": "Width",
			"options": [
				{ "value": "alignsmall", "label": "Narrow" },
				{ "value": "align", "label": "Regular" },
				{ "value": "alignwide", "label": "Wide" },
				{ "value": "alignfull", "label": "Full" }
			],
			"default": "alignwide"
		},
		{
			"type": "select",
			"id": "text_align",
			"label": "Header alignment",
			"options": [
				{ "value": "left", "label": "Left" },
				{ "value": "center", "label": "Center" }
			],
			"default": "center"
		},
		{
			"type": "range",
			"id": "columns_desktop",
			"label": "Columns (desktop)",
			"min": 1,
			"max": 4,
			"step": 1,
			"default": 4
		},
		{
			"type": "select",
			"id": "columns_tablet",
			"label": "Columns (tablet)",
			"options": [
				{ "value": "1", "label": "1" },
				{ "value": "2", "label": "2" },
				{ "value": "3", "label": "3" }
			],
			"default": "3"
		},
		{
			"type": "select",
			"id": "columns_mobile",
			"label": "Columns (mobile)",
			"options": [
				{ "value": "1", "label": "1" },
				{ "value": "2", "label": "2" }
			],
			"default": "2"
		},
		{
			"type": "header",
			"content": "Colors"
		},
		{
			"type": "color",
			"id": "background_color",
			"label": "Section background",
			"default": "#f8f8f8"
		},
		{
			"type": "color",
			"id": "text_color",
			"label": "Section text",
			"default": "#111111"
		},
		{
			"type": "color",
			"id": "card_background_color",
			"label": "Card background",
			"default": "#ffffff"
		},
		{
			"type": "color",
			"id": "card_text_color",
			"label": "Card text",
			"default": "#111111"
		},
		{
			"type": "header",
			"content": "Advanced"
		},
		{
			"type": "text",
			"id": "custom_class",
			"label": "Custom class",
			"info": "Add custom CSS class for styling"
		}
	],
	"blocks": [
		{
			"type": "blog",
			"name": "Blog feed",
			"settings": [
				{
					"type": "blog",
					"id": "blog",
					"label": "Select blog"
				}
			]
		}
	],
	"presets": [
		{
			"name": "Blogs",
			"category": "Marketing"
		}
	]
}
{% endschema %}
