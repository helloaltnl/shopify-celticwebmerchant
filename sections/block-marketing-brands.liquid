{%- liquid
	assign menu = linklists[section.settings.menu]
	assign has_heading = false
	if section.settings.heading != blank
		assign has_heading = true
	endif
	
	assign has_button = false
	if section.settings.button_url != blank
		assign has_button = true
	endif
	
	case section.settings.image_ratio
		when 'square'
			assign ratio = '1 / 1'
		when 'portrait'
			assign ratio = '2 / 3'
		when 'landscape'
			assign ratio = '3 / 2'
		else
			assign ratio = '1 / 1'
	endcase
-%}

<div class="block-marketing-brands__content {{ section.settings.width }}{% if section.settings.custom_class != blank %} {{ section.settings.custom_class }}{% endif %}">
	{%- if has_heading -%}
		<header class="block-marketing-brands__header">
			<h2 class="block-marketing-brands__title">{{ section.settings.heading }}</h2>
		</header>
	{%- endif -%}

	{%- if menu.links.size > 0 -%}
		<ul class="block-marketing-brands__grid{% if has_heading %} block-marketing-brands__grid--has-heading{% endif %}" role="list">
			{%- for link in menu.links -%}
				{%- liquid
					assign collection = collections[link.object.handle]
					if collection == blank
						assign collection = link.object
					endif
				-%}
				
				{%- if collection -%}
					<li class="block-marketing-brands__item">
						<a href="{{ collection.url }}" class="block-marketing-brands__link">
							{%- liquid
								assign brand_image = collection.image | default: collection.featured_image
							-%}
							{%- if brand_image -%}
								<figure class="block-marketing-brands__image">
									{{ brand_image | image_url: width: 400 | image_tag: loading: 'lazy', alt: collection.title }}
								</figure>
							{%- endif -%}
							{%- if section.settings.show_titles -%}
								<span class="block-marketing-brands__name">{{ collection.title }}</span>
							{%- endif -%}
						</a>
					</li>
				{%- endif -%}
			{%- endfor -%}
		</ul>
	{%- endif -%}

	{%- if has_button -%}
		<div class="block-marketing-brands__actions">
			{%- render 'html-marketing-cta',
				text: section.settings.button_text,
				url: section.settings.button_url,
				style: section.settings.button_style,
				button_color: section.settings.button_color,
				button_text_color: section.settings.button_text_color
			-%}
		</div>
	{%- endif -%}
</div>

{% style %}
	#shopify-section-{{ section.id }}.block-marketing-brands {
		background-color: {{ section.settings.background_color | default: '#ffffff' }};
		color: {{ section.settings.text_color | default: '#111111' }};
		padding-block: 3em;
	}

	.block-marketing-brands__header {
		text-align: center;
	}

	.block-marketing-brands__title {
		font-family: var(--theme-font-family-serif);
		font-size: 2em;
		font-weight: 400;
		margin: 0;
	}

	#shopify-section-{{ section.id }} .block-marketing-brands__grid {
		display: grid;
		grid-template-columns: repeat({{ section.settings.columns_mobile | default: 2 }}, 1fr);
		gap: 0.5em;
		list-style: none;
		margin: 0;
		padding: 0;
	}

	#shopify-section-{{ section.id }} .block-marketing-brands__grid--has-heading {
		margin-block-start: 2em;
	}

	@media (min-width: 750px) {
		#shopify-section-{{ section.id }} .block-marketing-brands__grid {
			grid-template-columns: repeat({{ section.settings.columns_tablet | default: 4 }}, 1fr);
		}
	}

	@media (min-width: 990px) {
		#shopify-section-{{ section.id }} .block-marketing-brands__grid {
			grid-template-columns: repeat({{ section.settings.columns_desktop | default: 6 }}, 1fr);
		}
	}

	.block-marketing-brands__item {
		margin: 0;
	}

	.block-marketing-brands__link {
		display: block;
		text-decoration: none;
		color: inherit;
		background-color: {{ section.settings.card_background | default: '#ffffff' }};
		border: 1px solid rgba(0, 0, 0, 0.1);
		overflow: hidden;
		transition: transform 200ms ease, box-shadow 200ms ease;
	}

	.block-marketing-brands__link:hover {
		transform: translateY(-4px);
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
	}

	.block-marketing-brands__image {
		width: 100%;
		aspect-ratio: {{ ratio }};
		overflow: hidden;
		background-color: {{ section.settings.card_background | default: '#ffffff' }};
		margin: 0;
		padding: 0.25em;
	}

	.block-marketing-brands__image img {
		width: 100%;
		height: calc(100% - 0.5em);
		object-fit: {{ section.settings.image_fit }};
	}

	.block-marketing-brands__name {
		display: block;
		padding: 1em;
		text-align: center;
		font-weight: 600;
	}

	.block-marketing-brands__actions {
		display: flex;
		justify-content: center;
		margin-block-start: 2em;
	}

	.block-marketing-brands__actions .marketing-cta {
		padding: 0;
	}
{% endstyle %}

{% schema %}
{
	"name": "Marketing brands",
	"tag": "section",
	"class": "block-marketing-brands",
	"disabled_on": {
		"groups": ["header", "footer"]
	},
	"settings": [
		{
			"type": "header",
			"content": "Content"
		},
		{
			"type": "text",
			"id": "heading",
			"label": "Heading"
		},
		{
			"type": "link_list",
			"id": "menu",
			"label": "Menu",
			"info": "Select a menu containing links to brand collections"
		},
		{
			"type": "text",
			"id": "button_text",
			"label": "Button text",
			"info": "Leave empty to use locale default"
		},
		{
			"type": "url",
			"id": "button_url",
			"label": "Button link"
		},
		{
			"type": "select",
			"id": "button_style",
			"label": "Button style",
			"options": [
				{ "value": "primary", "label": "Primary" },
				{ "value": "secondary", "label": "Secondary" },
				{ "value": "outline", "label": "Outline" }
			],
			"default": "primary"
		},
		{
			"type": "header",
			"content": "Collection card"
		},
		{
			"type": "checkbox",
			"id": "show_titles",
			"label": "Show brand titles",
			"default": true
		},
		{
			"type": "select",
			"id": "image_ratio",
			"label": "Image ratio",
			"options": [
				{ "value": "square", "label": "Square (1:1)" },
				{ "value": "portrait", "label": "Portrait (2:3)" },
				{ "value": "landscape", "label": "Landscape (3:2)" }
			],
			"default": "square"
		},
		{
			"type": "select",
			"id": "image_fit",
			"label": "Image fit",
			"options": [
				{ "value": "cover", "label": "Cover" },
				{ "value": "contain", "label": "Contain" }
			],
			"default": "contain"
		},
		{
			"type": "color",
			"id": "card_background",
			"label": "Card background",
			"default": "#ffffff"
		},
		{
			"type": "header",
			"content": "Layout"
		},
		{
			"type": "select",
			"id": "width",
			"label": "Width",
			"options": [
				{ "value": "alignsmall", "label": "Narrow" },
				{ "value": "align", "label": "Regular" },
				{ "value": "alignwide", "label": "Wide" },
				{ "value": "alignfull", "label": "Full" }
			],
			"default": "alignwide"
		},
		{
			"type": "range",
			"id": "columns_desktop",
			"label": "Columns (desktop)",
			"min": 2,
			"max": 8,
			"step": 1,
			"default": 6
		},
		{
			"type": "range",
			"id": "columns_tablet",
			"label": "Columns (tablet)",
			"min": 2,
			"max": 6,
			"step": 1,
			"default": 4
		},
		{
			"type": "range",
			"id": "columns_mobile",
			"label": "Columns (mobile)",
			"min": 1,
			"max": 4,
			"step": 1,
			"default": 2
		},
		{
			"type": "header",
			"content": "Colors"
		},
		{
			"type": "color",
			"id": "background_color",
			"label": "Background",
			"default": "#ffffff"
		},
		{
			"type": "color",
			"id": "text_color",
			"label": "Text",
			"default": "#111111"
		},
		{
			"type": "color",
			"id": "button_color",
			"label": "Button color"
		},
		{
			"type": "color",
			"id": "button_text_color",
			"label": "Button text color"
		},
		{
			"type": "header",
			"content": "Advanced"
		},
		{
			"type": "text",
			"id": "custom_class",
			"label": "Custom class",
			"info": "Add custom CSS class for styling"
		}
	],
	"presets": [
		{
			"name": "Brands",
			"category": "Marketing"
		}
	]
}
{% endschema %}
