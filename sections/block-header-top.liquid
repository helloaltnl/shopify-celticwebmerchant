{% comment %}
  ============================================================================
  BLOCK-HEADER-TOP
  ============================================================================
  Top header bar with USPs slider and region selector.

  FEATURES:
  - Configurable USPs via blocks
  - SwiperJS auto-sliding carousel on mobile
  - Region/language selector
  - Width alignment options

  DEPENDENCIES:
  - vendor-swiperjs.min.js (global)
  - vendor-swiperjs.min.css (global)
  - html-button-region snippet
  ============================================================================
{% endcomment %}

<div class="block-header-top__content {{ section.settings.width }}">
	
	{%- if section.blocks.size > 0 -%}
		<nav class="block-header-top__usps">
			<div class="swiper block-header-top__slider" data-usps-slider>
				<div class="swiper-wrapper">
					{%- for block in section.blocks -%}
						{%- if block.type == 'usp' -%}
							<div class="swiper-slide" {{ block.shopify_attributes }}>
								{%- if block.settings.link != blank -%}
									<a href="{{ block.settings.link }}" {% if block.settings.title != blank %}title="{{ block.settings.title }}"{% endif %}>
										{%- if block.settings.icon != 'none' -%}
											<i class="block-header-top__icon">
												{% render 'html-theme-icons', icon: block.settings.icon, size: 16 %}
											</i>
										{%- endif -%}
										<span>{{ block.settings.text }}</span>
									</a>
								{%- else -%}
									<span class="block-header-top__usp">
										{%- if block.settings.icon != 'none' -%}
											<i class="block-header-top__icon">
												{% render 'html-theme-icons', icon: block.settings.icon, size: 16 %}
											</i>
										{%- endif -%}
										<span>{{ block.settings.text }}</span>
									</span>
								{%- endif -%}
							</div>
						{%- endif -%}
					{%- endfor -%}
				</div>
			</div>
		</nav>
	{%- endif -%}

	{%- if section.settings.show_region_selector -%}
		<nav class="block-header-top__menu">
			{% render 'html-button-region' %}
		</nav>
	{%- endif -%}
</div>

{%- style -%}
	.block-header-top {
		background-color: {{ section.settings.background_color | default: '#2e130d' }};
		color: {{ section.settings.text_color | default: '#ffffff' }};
	}

	.block-header-top__content {
		display: flex;
		flex-direction: row;
		flex-wrap: nowrap;
		align-items: center;
		height: var(--header-top-height, 2.5em);
		gap: 1em;
		margin-left: auto;
		margin-right: auto;
	}

	.block-header-top__usps {
		flex: 1 1 auto;
		overflow: hidden;
		min-width: 0;
	}

	.block-header-top__slider {
		overflow: hidden;
	}

	.block-header-top__slider .swiper-wrapper {
		display: flex;
		align-items: center;
	}

	.block-header-top__slider .swiper-slide {
		width: auto;
		flex-shrink: 0;
		display: flex;
		align-items: center;
		padding-right: 2em;
	}

	.block-header-top__slider a,
	.block-header-top__usp {
		display: inline-flex;
		align-items: center;
		gap: 0.5em;
		color: inherit;
		text-decoration: none;
		opacity: 0.75;
		transition: opacity var(--theme-transition-fast);
		white-space: nowrap;
	}

	.block-header-top__slider a:hover {
		opacity: 1;
	}

	.block-header-top__icon {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		flex-shrink: 0;
	}

	.block-header-top__slider span {
		font-size: 0.75em;
		letter-spacing: var(--theme-letter-spacing);
	}

	.block-header-top__menu {
		flex: 0 0 auto;
		display: flex;
		align-items: center;
		gap: 1em;
	}
	
	.button-region {
		font-size:0.8em;
	}

	/* Mobile: enable autoplay sliding */
	@media (max-width: 40em) {
		.block-header-top__slider .swiper-slide {
			padding-right: 3em;
		}
	}
{%- endstyle -%}

<script>
	document.addEventListener('DOMContentLoaded', function() {
		const slider = document.querySelector('[data-usps-slider]');
		if (slider && typeof Swiper !== 'undefined') {
			new Swiper(slider, {
				slidesPerView: 'auto',
				spaceBetween: 0,
				loop: true,
				speed: 4000,
				autoplay: {
					delay: 5000,
					disableOnInteraction: false,
				},
				freeMode: true,
				freeModeMomentum: false,
				breakpoints: {
					640: {
						loop: false,
						autoplay: false,
						freeMode: true,
						slidesPerView: 'auto',
					}
				}
			});
		}
	});
</script>

{% schema %}
{
	"name": "Header top",
	"tag": "section",
	"class": "block-header-top",
	"limit": 1,
	"enabled_on": {
		"groups": ["header"]
	},
	"settings": [
		{
			"type": "header",
			"content": "Region"
		},
		{
			"type": "checkbox",
			"id": "show_region_selector",
			"label": "Show region selector",
			"default": true
		},
		{
			"type": "header",
			"content": "Layout"
		},
		{
			"type": "select",
			"id": "width",
			"label": "Width",
			"options": [
				{ "value": "is-align-narrow", "label": "Narrow" },
				{ "value": "is-align-small", "label": "Small" },
				{ "value": "is-align", "label": "Regular" },
				{ "value": "is-align-wide", "label": "Wide" },
				{ "value": "is-align-full", "label": "Full" }
			],
			"default": "is-align-wide"
		},
		{
			"type": "header",
			"content": "Colors"
		},
		{
			"type": "color",
			"id": "background_color",
			"label": "Background"
		},
		{
			"type": "color",
			"id": "text_color",
			"label": "Text"
		},
		{
			"type": "header",
			"content": "Howto"
		},
		{
			"type": "paragraph",
			"content": "Add USPs using blocks. On mobile, items auto-slide. Region selector pulls from Shopify Markets settings."
		}
	],
	"blocks": [
		{
			"type": "usp",
			"name": "USP",
			"settings": [
				{
					"type": "header",
					"content": "Content"
				},
				{
					"type": "text",
					"id": "text",
					"label": "Text",
					"placeholder": "Free shipping"
				},
				{
					"type": "url",
					"id": "link",
					"label": "Link"
				},
				{
					"type": "text",
					"id": "title",
					"label": "Link title",
					"placeholder": "Learn more about shipping"
				},
				{
					"type": "select",
					"id": "icon",
					"label": "Icon",
					"options": [
						{ "value": "none", "label": "None" },
						{ "value": "check-mark", "label": "Check mark" },
						{ "value": "truck", "label": "Truck" },
						{ "value": "cart", "label": "Cart" },
						{ "value": "star", "label": "Star" },
						{ "value": "heart", "label": "Heart" },
						{ "value": "lock", "label": "Lock" },
						{ "value": "return", "label": "Return" },
						{ "value": "stopwatch", "label": "Stopwatch" },
						{ "value": "price-tag", "label": "Price tag" },
						{ "value": "question-mark", "label": "Question mark" },
						{ "value": "chat-bubble", "label": "Chat bubble" },
						{ "value": "map-pin", "label": "Map pin" }
					],
					"default": "check-mark"
				}
			]
		},
		{
			"type": "@app"
		}
	],
	"presets": [
		{
			"name": "Top bar",
			"category": "Header",
			"blocks": [
				{ "type": "usp", "settings": { "icon": "truck" } },
				{ "type": "usp", "settings": { "icon": "stopwatch" } },
				{ "type": "usp", "settings": { "icon": "cart" } },
				{ "type": "usp", "settings": { "icon": "price-tag" } }
			]
		}
	]
}
{% endschema %}
