{%- comment -%}
  Section: block-product-overview.liquid
  - Filters (preview + aside) + grid + paginering.
  - Grid-only AJAX verversing (Section Rendering API).
  - Facet counts/disabled sync uit server HTML, zonder filter-DOM te vervangen.
  - Werkt op collection Ã©n search.
{%- endcomment -%}

{%- liquid
  assign resource = collection
  if resource == blank and search
	assign resource = search
  endif
-%}

<section class="block-product-overview-content alignwide">
	{%- render 'html-facets', 
		section_id: section.id,
		section_object: resource,
		section_settings: section.settings
	-%}
  

  {%- comment -%} ---------- GRID + PAGINATION (met data-grid) ---------- {%- endcomment -%}
  <div class="collection-products__grid" data-grid>
	{%- if resource == blank -%}
	  <p>No results.</p>
	{%- else -%}
	  {%- if collection -%}
		{%- paginate collection.products by 24 -%}
		  <div id="results-meta" data-count="{{ paginate.items }}"></div>
		  <ul id="product-grid" class="product-grid">
			{%- assign skip_card_product_styles = false -%}
			{%- for product in collection.products -%}
			  {%- assign lazy_load = false -%}
			  {%- if forloop.index > 2 -%}{%- assign lazy_load = true -%}{%- endif -%}
			  <li class="grid__item">
				{% render 'html-product-card', 
					product: product, 
					show_secondary_image: true,
					show_vendor: false, 
					show_price: true,
					show_stock: true,
					show_stock_from: 'auto',
					show_delivery: true,
					show_rating: true,
					show_badges: true, 
					quick_add: false 
				%}
			  </li>
			  {%- assign skip_card_product_styles = true -%}
			{%- endfor -%}
		  </ul>
		  {%- render 'pagination', paginate: paginate -%}
		{%- endpaginate -%}
	  {%- elsif search -%}
		{%- paginate search.results by 24 -%}
		  {%- assign products = search.results | where: 'object_type', 'product' -%}
		  <div id="results-meta" data-count="{{ paginate.items }}"></div>
		  {%- if products.size == 0 -%}
			<p>No products.</p>
		  {%- else -%}
			<ul id="product-grid" class="product-grid">
			  {%- assign skip_card_product_styles = false -%}
			  {%- for item in products -%}
				{%- assign product = item -%}
				{%- assign lazy_load = false -%}
				{%- if forloop.index > 2 -%}{%- assign lazy_load = true -%}{%- endif -%}
				<li class="grid__item">
					{% render 'html-product-card', 
						product: product, 
						show_secondary_image: true,
						show_vendor: false, 
						show_price:true,
						show_stock: true,
						show_delivery: true,
						show_rating: true,
						show_badges: true, 
						quick_add: false 
					%}
				  </li>
				{%- assign skip_card_product_styles = true -%}
			  {%- endfor -%}
			</ul>
			{%- render 'pagination', paginate: paginate -%}
		  {%- endif -%}
		{%- endpaginate -%}
	  {%- endif -%}
	{%- endif -%}
  </div>
</section>



{% style %}
.block-product-overview {
	background-color: var(--theme-color-grey);
	padding-top: 4em; padding-bottom: 4em;
}
.block-product-overview-content {
	
}
.product-grid { 
	display:grid; grid-template-columns:repeat(4,1fr); gap:.5em; list-style:none; padding:0; margin:0; 
	& > li { 
		display: inline-block; width:100%; max-width: 100%;
		& > .product-card { height:100%;}
	}
}
@media (max-width: 920px){ .product-grid { grid-template-columns:repeat(3,1fr); } }
@media (max-width: 640px){ .product-grid { grid-template-columns:repeat(2,1fr); } }
html.is-loading { cursor:progress; }
html.is-loading * { pointer-events:none; }
{% endstyle %}

{% schema %}
{
  "name": "Product overview",
  "tag": "section",
  "class": "block-product-overview",
  "disabled_on": { "groups": ["header", "footer"] },
  "settings": [
	{ "type": "checkbox", "id": "show_filter", "label": "Show filter", "default": true },
	{ "type": "checkbox", "id": "show_sort", "label": "Show sorting", "default": true },
		
	{ "type": "range", "id": "max_preview_filters", "label": "Max filters in preview", "min": 1, "max": 10, "step": 1, "default": 8 },
	{ "type": "checkbox", "id": "auto_fill_preview", "label": "Auto-fill preview (hide overflow)", "default": true },
	{ "type": "checkbox", "id": "auto_submit", "label": "Auto-submit on change", "default": true },
	
	{ "type": "text", "id": "drawer_title", "label": "Drawer title", "default": "Filters" },
	{ "type": "text", "id": "open_button_label", "label": "Open button label", "default": "Alle filters" },
	{ "type": "text", "id": "apply_button_label", "label": "Apply button label", "default": "Toepassen" },
	
	{ "type": "checkbox", "id": "ajax_pagination", "label": "AJAX pagination", "default": false },
	
	{ "type": "select", "id": "image_ratio", "label": "Image ratio", "default": "adapt", "options": [
	  { "value": "adapt", "label": "Adapt" }, { "value": "square", "label": "Square" }, { "value": "portrait", "label": "Portrait" }
	]},
	{ "type": "select", "id": "image_shape", "label": "Image shape", "default": "default", "options": [
	  { "value": "default", "label": "Default" }, { "value": "round", "label": "Round" }
	]},
	{ "type": "checkbox", "id": "show_secondary_image", "label": "Show secondary image", "default": true },
	{ "type": "checkbox", "id": "show_vendor", "label": "Show vendor", "default": false },
	{ "type": "checkbox", "id": "show_rating", "label": "Show rating", "default": false },
	{ "type": "checkbox", "id": "quick_add", "label": "Enable quick add", "default": false }
  ],
  "presets": [
	{ "name": "Product overview (S&D)", "category": "Products" }
  ]
}
{% endschema %}