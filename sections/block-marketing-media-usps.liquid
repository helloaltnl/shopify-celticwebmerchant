{%- comment -%}
============================================================================
BLOCK-MARKETING-MEDIA-USPS
============================================================================
Media + USP list section combining visual media with feature highlights.

FEATURES:
- Mobile-first: media always renders first in HTML
- Desktop: CSS order controls left/right positioning
- Image or native video (autoplays muted)
- USP blocks with icon, heading, and description
- Retina-optimized images (×3 multiplier)

DEPENDENCIES:
- html-theme-media-image snippet
- html-theme-icons snippet
- html-marketing-cta snippet
============================================================================
{%- endcomment -%}

{%- liquid
	assign has_heading = false
	if section.settings.heading != blank or section.settings.text != blank
		assign has_heading = true
	endif
	
	assign has_media = false
	if section.settings.image != blank or section.settings.video != blank
		assign has_media = true
	endif
	
	assign focus_x = section.settings.focus_x | default: 50
	assign focus_y = section.settings.focus_y | default: 50
	assign media_position = section.settings.media_position | default: 'left'
	assign media_width = section.settings.media_width | default: '50'
	assign media_height = section.settings.media_height | default: 'adapt'
	assign vertical_alignment = section.settings.vertical_alignment | default: 'center'
	
	comment
		Calculate sizes for retina (×3 multiplier)
	endcomment
	case section.settings.width
		when 'is-align-narrow'
			assign container_px = 600
		when 'is-align-small'
			assign container_px = 800
		when 'is-align'
			assign container_px = 1000
		when 'is-align-wide'
			assign container_px = 1400
		when 'is-align-full'
			assign container_px = 1600
		else
			assign container_px = 1000
	endcase
	
	assign media_fraction = media_width | divided_by: 100.0
	assign desktop_px = container_px | times: media_fraction | times: 3 | round
	assign mobile_px = 640 | times: 3
	
	assign img_sizes = '(min-width: 40em) ' | append: desktop_px | append: 'px, ' | append: mobile_px | append: 'px'
	
	comment
		Srcset widths
	endcomment
	assign base_width = container_px | times: media_fraction | round
	if base_width < 400
		assign base_width = 400
	endif
	
	assign w1 = base_width | round
	assign w2 = base_width | times: 1.5 | round
	assign w3 = base_width | times: 2 | round
	assign w4 = base_width | times: 2.5 | round
	assign w5 = base_width | times: 3 | round
	if w5 > 2048
		assign w5 = 2048
	endif
-%}

<div class="block-marketing-media-usps__content {{ section.settings.width }}{% if section.settings.custom_class != blank %} {{ section.settings.custom_class }}{% endif %}"{% if section.settings.anchor != blank %} id="{{ section.settings.anchor }}"{% endif %}>
	<article class="media-usps media-usps--{{ media_position }} media-usps--width-{{ media_width }} media-usps--align-{{ vertical_alignment }}{% if media_height == 'fill' %} media-usps--fill{% endif %}">
		
		{%- comment -%} Media - always first in HTML (mobile-first) {%- endcomment -%}
		{%- if has_media -%}
			<div class="media-usps__media media-usps__media--{{ media_height }}">
				{%- if section.settings.video != blank -%}
					<div class="media-usps__video-wrapper">
						{%- if section.settings.image != blank -%}
							<div class="media-usps__poster">
								{%- render 'html-theme-media-image',
								image: section.settings.image,
								alt: section.settings.image.alt | default: section.settings.heading,
								w1: w1,
								w2: w2,
								w3: w3,
								w4: w4,
								w5: w5,
								sizes: img_sizes,
								image_loading: 'lazy',
								focus_x: focus_x,
								focus_y: focus_y
								-%}
								</div>
								{%- endif -%}
						<video
							class="media-usps__video"
							autoplay
							muted
							loop
							playsinline
							style="object-position: {{ focus_x }}% {{ focus_y }}%;"
						>
							{%- for source in section.settings.video.sources -%}
								<source src="{{ source.url }}" type="{{ source.mime_type }}">
							{%- endfor -%}
						</video>
					</div>
				{%- elsif section.settings.image != blank -%}
					<figure class="media-usps__figure">
						{%- render 'html-theme-media-image',
							image: section.settings.image,
							alt: section.settings.image.alt | default: section.settings.heading,
							w1: w1,
							w2: w2,
							w3: w3,
							w4: w4,
							w5: w5,
							sizes: img_sizes,
							image_loading: 'lazy',
							focus_x: focus_x,
							focus_y: focus_y
						-%}
					</figure>
				{%- endif -%}
			</div>
		{%- endif -%}

		{%- comment -%} Content - always second in HTML {%- endcomment -%}
		<div class="media-usps__body">
			{%- if has_heading -%}
				<header class="media-usps__header">
					{%- if section.settings.heading != blank -%}
						<h2 class="media-usps__title">{{ section.settings.heading }}</h2>
					{%- endif -%}
					{%- if section.settings.text != blank -%}
						<div class="media-usps__text rte">{{ section.settings.text }}</div>
					{%- endif -%}
				</header>
			{%- endif -%}

			{%- if section.blocks.size > 0 -%}
				<ul class="media-usps__list{% if has_heading %} media-usps__list--has-heading{% endif %}" role="list">
					{%- for block in section.blocks -%}
						{%- if block.type == 'usp' -%}
							<li class="media-usps__item" {{ block.shopify_attributes }}>
								<div class="media-usps__icon">
									{%- if block.settings.icon != blank -%}
										{{ block.settings.icon }}
									{%- else -%}
										{%- render 'html-theme-icons', icon: 'checkmark', size: 24 -%}
									{%- endif -%}
								</div>
								<div class="media-usps__item-content">
									{%- if block.settings.heading != blank -%}
										<h3 class="media-usps__item-title">{{ block.settings.heading | escape }}</h3>
									{%- endif -%}
									{%- if block.settings.text != blank -%}
										<p class="media-usps__item-text">{{ block.settings.text }}</p>
									{%- endif -%}
								</div>
							</li>
						{%- endif -%}
					{%- endfor -%}
				</ul>
			{%- endif -%}

			{%- if section.settings.cta_url != blank -%}
				<div class="media-usps__actions">
					{%- render 'html-marketing-cta',
						text: section.settings.cta_text,
						url: section.settings.cta_url,
						style: section.settings.cta_style,
						alignment: 'left',
						button_color: section.settings.button_color,
						button_text_color: section.settings.button_text_color
					-%}
				</div>
			{%- endif -%}
		</div>
	</article>
</div>

{% style %}
#shopify-section-{{ section.id }}.block-marketing-media-usps {
	background-color: {{ section.settings.background_color }};
	color: {{ section.settings.text_color }};
	padding-block: {{ section.settings.padding_block }}em;
}

/* ===========================================
   Media + USPs Layout
   =========================================== */

.media-usps {
	display: grid;
	grid-template-columns: 1fr;
	gap: 2em;
}

.media-usps > * {
	min-width: 0;
}

/* Desktop: side-by-side */
@media (min-width: 40em) {
	.media-usps {
		gap: 3em;
	}
	
	/* Width variations */
	.media-usps--width-40 { grid-template-columns: 40% 1fr; }
	.media-usps--width-50 { grid-template-columns: 50% 1fr; }
	.media-usps--width-60 { grid-template-columns: 60% 1fr; }
	
	/* Position right: media moves to second column via order */
	.media-usps--right .media-usps__media { order: 2; }
	.media-usps--right .media-usps__body { order: 1; }
	
	/* Flip grid columns when media is on right */
	.media-usps--right.media-usps--width-40 { grid-template-columns: 1fr 40%; }
	.media-usps--right.media-usps--width-60 { grid-template-columns: 1fr 60%; }
}

/* Vertical alignment */
.media-usps--align-top { align-items: flex-start; }
.media-usps--align-center { align-items: center; }
.media-usps--align-bottom { align-items: flex-end; }

/* Fill mode: stretch both columns */
.media-usps--fill { align-items: stretch; }

/* ===========================================
   Media Container
   =========================================== */

.media-usps__media {
	position: relative;
	width: 100%;
	overflow: hidden;
}

.media-usps__figure {
	margin: 0;
	width: 100%;
	height: 100%;
}

.media-usps__figure .theme-media__img {
	width: 100%;
	height: 100%;
	object-fit: cover;
}

/* Height: adapt (natural aspect ratio) */
.media-usps__media--adapt .theme-media__img {
	height: auto;
	object-fit: contain;
}

/* Height: fill (stretch to content height) */
.media-usps__media--fill {
	min-height: 20em;
}

.media-usps__media--fill .media-usps__figure,
.media-usps__media--fill .media-usps__video-wrapper {
	position: absolute;
	inset: 0;
}

/* Height: fixed ratios */
.media-usps__media--square { aspect-ratio: 1 / 1; }
.media-usps__media--portrait { aspect-ratio: 2 / 3; }
.media-usps__media--landscape { aspect-ratio: 3 / 2; }

/* ===========================================
   Video
   =========================================== */

.media-usps__video-wrapper {
	position: relative;
	width: 100%;
	height: 100%;
	background-color: #111;
}

.media-usps__poster {
	position: absolute;
	inset: 0;
	z-index: 1;
	transition: opacity 0.3s ease;
}

.media-usps__poster .theme-media__img {
	width: 100%;
	height: 100%;
	object-fit: cover;
}

.media-usps__video-wrapper.is-playing .media-usps__poster {
	opacity: 0;
	pointer-events: none;
}

.media-usps__video {
	position: relative;
	z-index: 2;
	width: 100%;
	height: 100%;
	display: block;
	object-fit: cover;
}

/* ===========================================
   Body Content
   =========================================== */

.media-usps__body {
	display: flex;
	flex-direction: column;
	justify-content: center;
}

.media-usps__title {
	font-family: var(--theme-font-family-serif);
	font-size: clamp(1.6em, 4vw, 2.25em);
	font-weight: 400;
	margin: 0;
	line-height: 1.2;
}

.media-usps__text {
	margin-top: 1em;
	font-size: 1em;
	line-height: 1.6;
	opacity: 0.8;
}

/* ===========================================
   USP List
   =========================================== */

.media-usps__list {
	display: flex;
	flex-direction: column;
	gap: 1.5em;
	list-style: none;
	margin: 0;
	padding: 0;
}

.media-usps__list--has-heading {
	margin-block-start: 2em;
}

.media-usps__item {
	display: flex;
	gap: 1em;
	align-items: flex-start;
	margin: 0;
}

.media-usps__icon {
	flex-shrink: 0;
	width: 2em;
	height: 2em;
	display: flex;
	align-items: center;
	justify-content: center;
	background-color: {{ section.settings.icon_background | default: 'rgba(0, 0, 0, 0.05)' }};
	border-radius: 50%;
	color: {{ section.settings.icon_color | default: 'currentColor' }};
}

.media-usps__icon svg {
	width: 1em;
	height: 1em;
}

.media-usps__item-content {
	flex: 1;
	min-width: 0;
}

.media-usps__item-title {
	font-family: var(--theme-font-family-sans);
	font-size: 1.1em;
	font-weight: 600;
	margin: 0;
	line-height: 1.3;
}

.media-usps__item-text {
	margin: 0.25em 0 0;
	font-size: 0.9375em;
	line-height: 1.5;
	opacity: 0.75;
}

/* ===========================================
   Actions
   =========================================== */

.media-usps__actions {
	margin-block-start: 2em;
}

.media-usps__actions .marketing-cta {
	padding: 0;
}
{% endstyle %}

<script>
(function() {
	var section = document.getElementById('shopify-section-{{ section.id }}');
	if (!section) return;
	
	var wrapper = section.querySelector('.media-usps__video-wrapper');
	var video = section.querySelector('.media-usps__video');
	if (!wrapper || !video) return;
	
	video.addEventListener('playing', function() {
		wrapper.classList.add('is-playing');
	});
})();
</script>

{% schema %}
{
	"name": "Media + USPs",
	"tag": "section",
	"class": "block-marketing-media-usps",
	"disabled_on": {
		"groups": ["header", "footer"]
	},
	"settings": [
		{
			"type": "header",
			"content": "Content"
		},
		{
			"type": "text",
			"id": "heading",
			"label": "Heading"
		},
		{
			"type": "richtext",
			"id": "text",
			"label": "Description"
		},
		{
			"type": "text",
			"id": "cta_text",
			"label": "Button text",
			"info": "Leave empty to use locale default"
		},
		{
			"type": "url",
			"id": "cta_url",
			"label": "Button link"
		},
		{
			"type": "select",
			"id": "cta_style",
			"label": "Button style",
			"options": [
				{ "value": "primary", "label": "Primary" },
				{ "value": "secondary", "label": "Secondary" },
				{ "value": "outline", "label": "Outline" }
			],
			"default": "primary"
		},
		{
			"type": "header",
			"content": "Media"
		},
		{
			"type": "image_picker",
			"id": "image",
			"label": "Image",
			"info": "Also used as video poster"
		},
		{
			"type": "video",
			"id": "video",
			"label": "Video",
			"info": "Autoplays muted. Image is used as poster."
		},
		{
			"type": "select",
			"id": "media_height",
			"label": "Media height",
			"options": [
				{ "value": "adapt", "label": "Adapt to media" },
				{ "value": "fill", "label": "Fill to content" },
				{ "value": "square", "label": "Square (1:1)" },
				{ "value": "portrait", "label": "Portrait (2:3)" },
				{ "value": "landscape", "label": "Landscape (3:2)" }
			],
			"default": "adapt"
		},
		{
			"type": "range",
			"id": "focus_x",
			"label": "Horizontal focus",
			"min": 0,
			"max": 100,
			"step": 5,
			"default": 50,
			"unit": "%"
		},
		{
			"type": "range",
			"id": "focus_y",
			"label": "Vertical focus",
			"min": 0,
			"max": 100,
			"step": 5,
			"default": 50,
			"unit": "%"
		},
		{
			"type": "header",
			"content": "Layout"
		},
		{
			"type": "select",
			"id": "width",
			"label": "Width",
			"options": [
				{ "value": "is-align-narrow", "label": "Narrow" },
				{ "value": "is-align-small", "label": "Small" },
				{ "value": "is-align", "label": "Regular" },
				{ "value": "is-align-wide", "label": "Wide" },
				{ "value": "is-align-full", "label": "Full" }
			],
			"default": "is-align-wide"
		},
		{
			"type": "select",
			"id": "media_position",
			"label": "Media position",
			"options": [
				{ "value": "left", "label": "Left" },
				{ "value": "right", "label": "Right" }
			],
			"default": "left"
		},
		{
			"type": "select",
			"id": "media_width",
			"label": "Media width",
			"options": [
				{ "value": "40", "label": "40%" },
				{ "value": "50", "label": "50%" },
				{ "value": "60", "label": "60%" }
			],
			"default": "50"
		},
		{
			"type": "select",
			"id": "vertical_alignment",
			"label": "Vertical alignment",
			"options": [
				{ "value": "top", "label": "Top" },
				{ "value": "center", "label": "Center" },
				{ "value": "bottom", "label": "Bottom" }
			],
			"default": "center"
		},
		{
			"type": "range",
			"id": "padding_block",
			"label": "Vertical padding",
			"min": 0,
			"max": 6,
			"step": 0.5,
			"default": 3,
			"unit": "em"
		},
		{
			"type": "header",
			"content": "Colors"
		},
		{
			"type": "color",
			"id": "background_color",
			"label": "Background"
		},
		{
			"type": "color",
			"id": "text_color",
			"label": "Text"
		},
		{
			"type": "color",
			"id": "icon_background",
			"label": "Icon background"
		},
		{
			"type": "color",
			"id": "icon_color",
			"label": "Icon color"
		},
		{
			"type": "color",
			"id": "button_color",
			"label": "Button color"
		},
		{
			"type": "color",
			"id": "button_text_color",
			"label": "Button text color"
		},
		{
			"type": "header",
			"content": "Advanced"
		},
		{
			"type": "text",
			"id": "anchor",
			"label": "Anchor",
			"info": "ID for scroll links (without #)"
		},
		{
			"type": "text",
			"id": "custom_class",
			"label": "Custom class",
			"info": "Add custom CSS class for styling"
		}
	],
	"blocks": [
		{
			"type": "usp",
			"name": "USP",
			"settings": [
				{
					"type": "html",
					"id": "icon",
					"label": "Icon (SVG)",
					"info": "Leave empty for default checkmark"
				},
				{
					"type": "text",
					"id": "heading",
					"label": "Heading"
				},
				{
					"type": "textarea",
					"id": "text",
					"label": "Description"
				}
			]
		}
	],
	"max_blocks": 8,
	"presets": [
		{
			"name": "Media + USPs",
			"category": "Marketing",
			"blocks": [
				{
					"type": "usp",
					"settings": {
						"heading": "Snelle levering",
						"text": "Gratis verzending vanaf €50"
					}
				},
				{
					"type": "usp",
					"settings": {
						"heading": "Veilig betalen",
						"text": "Alle gangbare betaalmethodes"
					}
				},
				{
					"type": "usp",
					"settings": {
						"heading": "Kwaliteit gegarandeerd",
						"text": "30 dagen niet goed, geld terug"
					}
				}
			]
		}
	]
}
{% endschema %}
