{%- comment -%}
  ============================================================================
  BLOCK-PRODUCT-BLOGS
  ============================================================================
  Related articles and knowledge base references for products.

  FEATURES:
  - Blog post references from product metafield
  - Knowledge base references from product metafield
  - Card layout with images
  - Width alignment options
  - Color customization

  DEPENDENCIES:
  - html-theme-icons snippet
  - Product metafields:
    - custom.product-blogpost-references
    - custom.product-knowledgebase-references
  ============================================================================
{%- endcomment -%}

{%- assign blogpost_references = product.metafields.custom['product-blogpost-references'] -%}
{%- assign knowledge_references = product.metafields.custom['product-knowledgebase-references'] -%}

{%- liquid
  assign heading_text = section.settings.heading
  if heading_text == blank
    assign heading_text = 'product.related_blogs_heading' | t
  endif
  assign read_more_text = section.settings.read_more_text
  if read_more_text == blank
    assign read_more_text = 'general.read_more' | t
  endif
-%}

{%- if blogpost_references or knowledge_references -%}
<div class="block-product-blogs__content {{ section.settings.width }}">
  <header class="block-product-blogs__header">
    <h2 class="block-product-blogs__title">{{ heading_text }}</h2>
  </header>

  <div class="block-product-blogs__grid">
    {%- if blogpost_references -%}
      <div class="block-product-blogs__articles-wrapper">
        {%- for article_reference in blogpost_references.value -%}
          {%- if forloop.first -%}
            <article class="block-product-blogs__card block-product-blogs__card--featured">
              <a href="{{ article_reference.link.value.url }}" class="block-product-blogs__card-link" target="_blank" rel="noopener"></a>
              {%- if article_reference.thumb -%}
                <figure class="block-product-blogs__card-image">
                  <img
                    src="{{ article_reference.thumb | image_url: width: 600 }}"
                    alt="{{ article_reference.title | escape }}"
                    loading="lazy"
                    width="300"
                    height="400"
                  >
                </figure>
              {%- endif -%}
              <div class="block-product-blogs__card-content">
                <h3 class="block-product-blogs__card-title">{{ article_reference.title }}</h3>
                {%- if article_reference.excerpt -%}
                  <p class="block-product-blogs__card-excerpt">{{ article_reference.excerpt }}</p>
                {%- endif -%}
                {%- if article_reference.link -%}
                  <span class="block-product-blogs__card-cta">
                    <span>{{ read_more_text }}</span>
                    {%- render 'html-theme-icons', icon: 'arrow', size: 14 -%}
                  </span>
                {%- endif -%}
              </div>
            </article>
          {%- endif -%}
        {%- endfor -%}

        <ul class="block-product-blogs__articles">
          {%- for article_reference in blogpost_references.value offset: 1 -%}
            <li class="block-product-blogs__item">
              <article class="block-product-blogs__card block-product-blogs__card--article">
                <a href="{{ article_reference.link.value.url }}" class="block-product-blogs__card-link" target="_blank" rel="noopener"></a>
                {%- if article_reference.thumb -%}
                  <figure class="block-product-blogs__card-image">
                    <img
                      src="{{ article_reference.thumb | image_url: width: 400 }}"
                      alt="{{ article_reference.title | escape }}"
                      loading="lazy"
                      width="200"
                      height="300"
                    >
                  </figure>
                {%- endif -%}
                <div class="block-product-blogs__card-content">
                  <h3 class="block-product-blogs__card-title">{{ article_reference.title }}</h3>
                  {%- if article_reference.excerpt -%}
                    <p class="block-product-blogs__card-excerpt">{{ article_reference.excerpt }}</p>
                  {%- endif -%}
                  {%- if article_reference.link -%}
                    <span class="block-product-blogs__card-cta">
                      <span>{{ read_more_text }}</span>
                      {%- render 'html-theme-icons', icon: 'arrow', size: 14 -%}
                    </span>
                  {%- endif -%}
                </div>
              </article>
            </li>
          {%- endfor -%}
        </ul>
      </div>
    {%- endif -%}

    {%- if knowledge_references -%}
      <ul class="block-product-blogs__knowledge">
        {%- for article_reference in knowledge_references.value -%}
          <li class="block-product-blogs__item">
            <article class="block-product-blogs__card block-product-blogs__card--knowledge">
              <a href="{{ article_reference.link.value.url }}" class="block-product-blogs__card-link" target="_blank" rel="noopener"></a>
              <div class="block-product-blogs__card-content">
                <h4 class="block-product-blogs__card-title">{{ article_reference.title }}</h4>
                {%- if article_reference.excerpt -%}
                  <p class="block-product-blogs__card-excerpt">{{ article_reference.excerpt }}</p>
                {%- endif -%}
                {%- if article_reference.link -%}
                  <span class="block-product-blogs__card-cta">
                    <span>{{ read_more_text }}</span>
                    {%- render 'html-theme-icons', icon: 'arrow', size: 14 -%}
                  </span>
                {%- endif -%}
              </div>
            </article>
          </li>
        {%- endfor -%}
      </ul>
    {%- endif -%}
  </div>
</div>
{%- endif -%}

<style>
  .block-product-blogs {
    background-color: {{ section.settings.background_color }};
    color: {{ section.settings.text_color }};
    
  }
  .block-product-blogs__content {
    padding-block: 3em;
  }
  .block-product-blogs__header {
    margin-bottom: 2em;
    text-align: center;
  }

  .block-product-blogs__title {
    font-family: var(--theme-font-family-serif);
    font-size: 2em;
    font-weight: 400;
    margin: 0;
  }

  .block-product-blogs__grid {
    display: flex;
    flex-direction: column;
    gap: 2em;
  }

  .block-product-blogs__articles-wrapper {
    display: flex;
    gap: 1em;
    align-items: flex-start;
  }

  /* Featured card (first article) */
  .block-product-blogs__card--featured {
    flex: 0 0 33%;
    flex-direction: column !important;
    background-color: var(--theme-color-white);
    color: var(--theme-color-blue);
  }

  .block-product-blogs__card--featured .block-product-blogs__card-image {
    flex: 0 0 auto;
    aspect-ratio: 3 / 4;
    margin: 0;
    padding: 0;
    overflow: hidden;
  }

  .block-product-blogs__card--featured .block-product-blogs__card-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 200ms ease;
  }

  .block-product-blogs__card--featured:hover .block-product-blogs__card-image img {
    transform: scale(1.05);
  }

  .block-product-blogs__card--featured .block-product-blogs__card-title {
    font-size: 1.4em;
  }

  /* Article list (cards 2+) */
  .block-product-blogs__articles {
    flex: 0 0 66%;
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.5em;
    list-style: none;
    margin: 0;
    padding: 0;
    align-items: stretch;
  }

  .block-product-blogs__articles .block-product-blogs__item {
    height: 100%;
  }

  /* Card base */
  .block-product-blogs__card {
    position: relative;
    display: flex;
    flex-direction: row;
    height: 100%;
    overflow: hidden;
  }

  .block-product-blogs__card-link {
    position: absolute;
    inset: 0;
    z-index: 5;
  }

  /* Article card */
  .block-product-blogs__card--article {
    background-color: var(--theme-color-white);
    color: var(--theme-color-blue);
  }

  .block-product-blogs__card--article .block-product-blogs__card-image {
    flex: 0 0 80px;
    margin: 0;
    padding: 0;
    overflow: hidden;
  }

  .block-product-blogs__card--article .block-product-blogs__card-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 200ms ease;
  }

  .block-product-blogs__card--article:hover .block-product-blogs__card-image img {
    transform: scale(1.05);
  }

  .block-product-blogs__card--article .block-product-blogs__card-title {
    font-size: 1em;
  }

  .block-product-blogs__card--article .block-product-blogs__card-excerpt {
    display: none;
  }

  /* Knowledge list */
  .block-product-blogs__knowledge {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 0.5em;
    list-style: none;
    margin: 0;
    padding: 0;
  }

  /* Knowledge card */
  .block-product-blogs__card--knowledge {
    background-color: {{ section.settings.knowledge_background_color }};
    color: {{ section.settings.knowledge_text_color }};
  }

  /* Card content */
  .block-product-blogs__card-content {
    flex: 1 1 auto;
    padding: 1em;
    display: flex;
    flex-direction: column;
  }

  .block-product-blogs__card-title {
    font-family: var(--theme-font-family-serif);
    font-weight: 400;
    line-height: 1.2;
    margin: 0 0 0.25em 0;
  }

  .block-product-blogs__card--knowledge .block-product-blogs__card-title {
    font-size: 1em;
  }

  .block-product-blogs__card-excerpt {
    font-size: 0.85em;
    line-height: 1.4;
    margin: 0 0 0.5em 0;
    opacity: 0.9;
  }

  .block-product-blogs__card-cta {
    display: inline-flex;
    align-items: center;
    gap: 0.4em;
    margin-top: auto;
    font-size: 0.9em;
    color: inherit;
  }

  .block-product-blogs__card-cta svg {
    transition: transform 150ms ease;
  }

  .block-product-blogs__card:hover .block-product-blogs__card-cta svg {
    transform: translateX(0.25em);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .block-product-blogs__articles-wrapper {
      flex-direction: column;
    }

    .block-product-blogs__card--featured {
      flex: 0 0 auto;
      width: 100%;
    }

    .block-product-blogs__card--featured .block-product-blogs__card-image {
      aspect-ratio: 16 / 9;
    }

    .block-product-blogs__articles {
      flex: 0 0 auto;
      width: 100%;
      grid-template-columns: 1fr;
    }

    .block-product-blogs__knowledge {
      grid-template-columns: 1fr;
    }
  }
</style>

{% schema %}
{
	"name": "Product blogs",
	"tag": "section",
	"class": "block-product-blogs",
	"enabled_on": {
		"templates": ["product"]
	},
	"settings": [
		{
			"type": "header",
			"content": "Content"
		},
		{
			"type": "text",
			"id": "heading",
			"label": "Heading",
			"info": "Leave empty to use locale default"
		},
		{
			"type": "text",
			"id": "read_more_text",
			"label": "Read more text",
			"info": "Leave empty to use locale default"
		},
		{
			"type": "header",
			"content": "Layout"
		},
		{
			"type": "select",
			"id": "width",
			"label": "Width",
			"options": [
				{ "value": "alignsmall", "label": "Narrow" },
				{ "value": "align", "label": "Regular" },
				{ "value": "alignwide", "label": "Wide" },
				{ "value": "alignfull", "label": "Full" }
			],
			"default": "align"
		},
		{
			"type": "header",
			"content": "Colors"
		},
		{
			"type": "color",
			"id": "background_color",
			"label": "Background",
			"default": "#f8f8f8"
		},
		{
			"type": "color",
			"id": "text_color",
			"label": "Text",
			"default": "#111111"
		},
		{
			"type": "color",
			"id": "knowledge_background_color",
			"label": "Knowledge card background",
			"default": "#0f1f38"
		},
		{
			"type": "color",
			"id": "knowledge_text_color",
			"label": "Knowledge card text",
			"default": "#ffffff"
		},
		{
			"type": "header",
			"content": "How to use"
		},
		{
			"type": "paragraph",
			"content": "This section displays blog posts and knowledge base articles linked to the product. Content is pulled from product metafields."
		},
		{
			"type": "paragraph",
			"content": "Metafields: custom.product-blogpost-references and custom.product-knowledgebase-references"
		}
	],
	"presets": [
		{
			"name": "Blogs",
			"category": "Product"
		}
	]
}
{% endschema %}
