!function(){"use strict";const e={overlay:null,input:null,results:null,config:null,previousFocus:null,abortController:null,debounceTimer:null,searchCache:new Map,recentSearchesKey:"theme_recent_searches",init(){this.bindTriggerEvents(),this.overlay=document.querySelector("[data-search-overlay]"),this.overlay&&(this.input=this.overlay.querySelector('input[type="search"]'),this.results=this.overlay.querySelector("[data-search-results]"),this.config=this.loadConfig(),this.bindOverlayEvents())},loadConfig(){const e=this.overlay.querySelector("[data-search-config]");if(!e)return{blocks:[],routes:{},strings:{}};try{return JSON.parse(e.textContent)}catch(e){return console.error("[theme-search] Failed to parse config:",e),{blocks:[],routes:{},strings:{}}}},bindTriggerEvents(){document.addEventListener("click",(e=>{e.target.closest("[data-search-trigger]")&&this.open()&&e.preventDefault()})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&this.isOpen()&&(e.preventDefault(),this.close())}))},bindOverlayEvents(){this.overlay.addEventListener("click",(e=>{e.target.closest("[data-search-close]")&&(e.preventDefault(),this.close())})),this.input&&(this.input.addEventListener("input",(()=>{this.debounce((()=>this.onInputChange()),300)})),this.input.addEventListener("focus",(()=>{this.input.value.trim()||this.showInitialState()}))),this.overlay.addEventListener("keydown",(e=>this.handleFocusTrap(e))),document.addEventListener("shopify:section:unload",(()=>this.close()))},open(){return!!this.overlay&&(window.themeModal&&window.themeModal.closeAll(),window.themeDrawer&&window.themeDrawer.closeAll(),this.previousFocus=document.activeElement,this.overlay.hidden=!1,this.overlay.classList.add("is-open"),document.body.classList.add("has-search-open"),requestAnimationFrame((()=>{this.input&&(this.input.focus(),this.input.select())})),this.input&&!this.input.value.trim()&&this.showInitialState(),document.dispatchEvent(new CustomEvent("search:open")),!0)},close(){return!!this.overlay&&(this.overlay.classList.remove("is-open"),document.body.classList.remove("has-search-open"),setTimeout((()=>{this.overlay.hidden=!0}),300),this.previousFocus&&(this.previousFocus.focus(),this.previousFocus=null),this.results&&(this.results.innerHTML=""),document.dispatchEvent(new CustomEvent("search:close")),!0)},isOpen(){return this.overlay&&!this.overlay.hidden},handleFocusTrap(e){if("Tab"!==e.key)return;const s=this.overlay.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!s.length)return;const t=s[0],r=s[s.length-1];e.shiftKey&&document.activeElement===t?(e.preventDefault(),r.focus()):e.shiftKey||document.activeElement!==r||(e.preventDefault(),t.focus())},onInputChange(){const e=this.input.value.trim();e?this.fetchResults(e):this.showInitialState()},showInitialState(){if(!this.results)return;let e="";const s=this.config.blocks.find((e=>"popular_searches"===e.type));s&&s.settings.terms&&(e+=this.renderPopularSearches(s));const t=this.config.blocks.find((e=>"recent_searches"===e.type));if(t){const s=this.renderRecentSearches(t);s&&(e+=s)}this.results.innerHTML=e||""},fetchResults(e){if(this.searchCache.has(e))return void this.renderResults(e,this.searchCache.get(e));this.abortController&&this.abortController.abort(),this.abortController=new AbortController,this.results.innerHTML='<div class="search-results__loading"></div>';const s=this.getEnabledTypes(),t=this.getMaxLimit();let r=this.config.routes.root||"/";r.endsWith("/")||(r+="/"),fetch(`${r}search/suggest.json?q=${encodeURIComponent(e)}&resources[type]=${s.join(",")}&resources[limit]=${t}`,{signal:this.abortController.signal}).then((e=>e.json())).then((s=>{this.searchCache.set(e,s),this.renderResults(e,s),this.saveRecentSearch(e)})).catch((e=>{"AbortError"!==e.name&&(console.error("[theme-search] Fetch error:",e),this.results.innerHTML="")}))},getEnabledTypes(){const e=[];return this.config.blocks.forEach((s=>{"product_results"===s.type&&e.push("product"),"collection_results"===s.type&&e.push("collection"),"article_results"===s.type&&e.push("article"),"page_results"===s.type&&e.push("page")})),e.length?e:["product"]},getMaxLimit(){let e=6;return this.config.blocks.forEach((s=>{s.settings&&s.settings.limit>e&&(e=s.settings.limit)})),e},renderResults(e,s){const t=s.resources?.results?.products||[],r=s.resources?.results?.collections||[],n=s.resources?.results?.articles||[],i=s.resources?.results?.pages||[];if(0===t.length+r.length+n.length+i.length){const s=(this.config.strings.noResults||"No results found").replace("{{ terms }}",e).replace("{{terms}}",e);return void(this.results.innerHTML=`\n          <div class="search-results__empty">\n            <p>${s}</p>\n          </div>\n        `)}let a='<div class="search-results__grid">';this.config.blocks.forEach((e=>{"product_results"===e.type&&t.length?a+=this.renderProductResults(e,t):"collection_results"===e.type&&r.length?a+=this.renderCollectionResults(e,r):"article_results"===e.type&&n.length?a+=this.renderArticleResults(e,n):"page_results"===e.type&&i.length&&(a+=this.renderPageResults(e,i))})),a+="</div>";const c=this.config.routes.search||"/search";a+=`\n        <div class="search-results__footer">\n          <a href="${c}?q=${encodeURIComponent(e)}" class="search-results__view-all">\n            ${this.config.strings.viewAll||"View all results"}\n          </a>\n        </div>\n      `,this.results.innerHTML=a},renderPopularSearches(e){const s=(e.settings.terms||"").split(",").map((e=>e.trim())).filter((e=>e));if(!s.length)return"";let t=this.config.routes.root||"/";return t.endsWith("/")||(t+="/"),`\n        <div class="search-results__section search-results__section--popular">\n          <h3 class="search-results__heading">${e.settings.heading}</h3>\n          <div class="search-results__tags">\n            ${s.map((e=>`\n              <a href="${t}search?q=${encodeURIComponent(e)}" class="search-results__tag">${e}</a>\n            `)).join("")}\n          </div>\n        </div>\n      `},renderRecentSearches(e){const s=this.getRecentSearches(e.settings.limit||5);if(!s.length)return"";let t=this.config.routes.root||"/";return t.endsWith("/")||(t+="/"),`\n        <div class="search-results__section search-results__section--recent">\n          <h3 class="search-results__heading">${e.settings.heading}</h3>\n          <div class="search-results__tags">\n            ${s.map((e=>`\n              <a href="${t}search?q=${encodeURIComponent(e)}" class="search-results__tag search-results__tag--recent">\n                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                  <circle cx="12" cy="12" r="10"/>\n                  <polyline points="12 6 12 12 16 14"/>\n                </svg>\n                ${e}\n              </a>\n            `)).join("")}\n          </div>\n        </div>\n      `},renderProductResults(e,s){const t=s.slice(0,e.settings.limit||6);return`\n        <div class="search-results__section search-results__section--products">\n          <h3 class="search-results__heading">${e.settings.heading}</h3>\n          <div class="search-results__items">\n            ${t.map((s=>`\n              <a href="${s.url}" class="search-results__item">\n                ${s.featured_image?`\n                  <img src="${this.getImageUrl(s.featured_image,"120x120")}" alt="${s.title}" loading="lazy" width="60" height="60">\n                `:'<span class="search-results__placeholder"></span>'}\n                <div class="search-results__content">\n                  ${e.settings.show_vendor&&s.vendor?`<span class="search-results__vendor">${s.vendor}</span>`:""}\n                  <span class="search-results__title">${s.title}</span>\n                  ${e.settings.show_price&&s.price?`<span class="search-results__price">${this.formatMoney(s.price)}</span>`:""}\n                </div>\n              </a>\n            `)).join("")}\n          </div>\n        </div>\n      `},renderCollectionResults(e,s){const t=s.slice(0,e.settings.limit||4);return`\n        <div class="search-results__section search-results__section--collections">\n          <h3 class="search-results__heading">${e.settings.heading}</h3>\n          <div class="search-results__items search-results__items--compact">\n            ${t.map((e=>`\n              <a href="${e.url}" class="search-results__item search-results__item--compact">\n                <span class="search-results__title">${e.title}</span>\n              </a>\n            `)).join("")}\n          </div>\n        </div>\n      `},renderArticleResults(e,s){const t=s.slice(0,e.settings.limit||4);return`\n        <div class="search-results__section search-results__section--articles">\n          <h3 class="search-results__heading">${e.settings.heading}</h3>\n          <div class="search-results__items search-results__items--compact">\n            ${t.map((e=>`\n              <a href="${e.url}" class="search-results__item search-results__item--compact">\n                <span class="search-results__title">${e.title}</span>\n              </a>\n            `)).join("")}\n          </div>\n        </div>\n      `},renderPageResults(e,s){const t=s.slice(0,e.settings.limit||4);return`\n        <div class="search-results__section search-results__section--pages">\n          <h3 class="search-results__heading">${e.settings.heading}</h3>\n          <div class="search-results__items search-results__items--compact">\n            ${t.map((e=>`\n              <a href="${e.url}" class="search-results__item search-results__item--compact">\n                <span class="search-results__title">${e.title}</span>\n              </a>\n            `)).join("")}\n          </div>\n        </div>\n      `},getImageUrl(e,s){if(!e)return null;const t="string"==typeof e?e:e.url;return t?t.replace(/(\.[^.]+)$/,`_${s}$1`):null},formatMoney(e){const s=parseFloat(e).toFixed(2),t=this.config.moneyFormat||"â‚¬{{amount}}",r=s.split("."),n=r[0].replace(/\B(?=(\d{3})+(?!\d))/g,"."),i=r[1];return t.replace("{{amount}}",s.replace(".",",")).replace("{{amount_no_decimals}}",n).replace("{{amount_with_comma_separator}}",n+","+i).replace("{{amount_no_decimals_with_comma_separator}}",n).replace("{{amount_with_apostrophe_separator}}",n.replace(/\./g,"'")+"."+i)},getRecentSearches(e){try{return JSON.parse(localStorage.getItem(this.recentSearchesKey)||"[]").slice(0,e)}catch(e){return[]}},saveRecentSearch(e){try{let s=JSON.parse(localStorage.getItem(this.recentSearchesKey)||"[]");s=s.filter((s=>s.toLowerCase()!==e.toLowerCase())),s.unshift(e),s=s.slice(0,10),localStorage.setItem(this.recentSearchesKey,JSON.stringify(s))}catch(e){}},debounce(e,s){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(e,s)}};function s(){e.init()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",s):s(),window.themeSearch={open:()=>e.open(),close:()=>e.close(),isOpen:()=>e.isOpen()}}();