{%- comment -%}
============================================================================
HTML-MARKETING-GRID-BANNER
============================================================================
Banner with image and text overlay for use in grid layouts.
Uses global .is-marketing-card utilities from theme-ux.scss.

PARAMETERS:
- image           : Banner background image (required)
- focus_x         : Horizontal focus point 0-100 (default 50)
- focus_y         : Vertical focus point 0-100 (default 50)
- overlay         : 'none' | 'light' | 'medium' | 'dark' (default 'medium')
- label           : Small label/badge text (optional)
- heading         : Banner heading (required)
- text            : Banner description text (optional, richtext)
- link_url        : Link URL (optional)
- design          : 'blue' | 'red' | 'green' (default 'blue')
- block_id        : Unique block ID for styling
- columns_desktop : Number of columns on desktop (default 3)
- columns_tablet  : Number of columns on tablet (default 2)
- columns_mobile  : Number of columns on mobile (default 1)
- columns_width   : Container width class (default 'is-align-wide')
- columns_gap     : Gap between grid items in em (default 1)

NOTES:
- Uses direct html-theme-media-image for focus point support
- Sizes = actual display size, srcset = 1x-3x for retina
- Quality default 70% via html-theme-media-image

DEPENDENCIES:
- html-theme-media-image snippet
- Global .is-marketing-card utilities from theme-ux.scss
============================================================================
{%- endcomment -%}

{%- liquid
	assign heading = heading | default: 'Banner title'
	assign design = design | default: 'blue'
	assign overlay = overlay | default: 'medium'
	assign focus_x = focus_x | default: 50
	assign focus_y = focus_y | default: 50
	assign columns_desktop = columns_desktop | default: 3
	assign columns_tablet = columns_tablet | default: 2
	assign columns_mobile = columns_mobile | default: 1
	assign columns_width = columns_width | default: 'is-align-wide'
	assign columns_gap = columns_gap | default: 1
	
	comment
		Container width in pixels (match theme-ui.scss)
	endcomment
	case columns_width
		when 'is-align-narrow'
			assign container_px = 480
		when 'is-align-small'
			assign container_px = 640
		when 'is-align'
			assign container_px = 960
		when 'is-align-wide'
			assign container_px = 1280
		when 'is-align-full'
			assign container_px = 1600
		else
			assign container_px = 1280
	endcase
	
	comment
		Gap in pixels
	endcomment
	assign gap_px = columns_gap | times: 16
	
	comment
		Calculate actual display sizes per breakpoint
	endcomment
	assign desktop_gaps = columns_desktop | minus: 1 | times: gap_px
	assign desktop_available = container_px | minus: desktop_gaps
	assign desktop_image = desktop_available | divided_by: columns_desktop | round
	
	assign tablet_gaps = columns_tablet | minus: 1 | times: gap_px
	assign tablet_available = 960 | minus: tablet_gaps
	assign tablet_image = tablet_available | divided_by: columns_tablet | round
	
	assign mobile_gaps = columns_mobile | minus: 1 | times: gap_px
	assign mobile_available = 480 | minus: mobile_gaps
	assign mobile_image = mobile_available | divided_by: columns_mobile | round
	
	comment
		Build sizes attribute (actual display sizes, not Ã—3)
	endcomment
	assign img_sizes = '(min-width: 60em) ' | append: desktop_image | append: 'px, (min-width: 40em) ' | append: tablet_image | append: 'px, ' | append: mobile_image | append: 'px'
	
	comment
		Srcset widths based on desktop (largest display)
		Provides 1x, 1.5x, 2x, 2.5x, 3x for retina
	endcomment
	assign base = desktop_image
	if base < 200
		assign base = 200
	endif
	
	assign w1 = base | round
	assign w2 = base | times: 1.5 | round
	assign w3 = base | times: 2 | round
	assign w4 = base | times: 2.5 | round
	assign w5 = base | times: 3 | round
	if w5 > 2048
		assign w5 = 2048
	endif
	if w4 > 2048
		assign w4 = 2048
	endif
-%}

<div class="is-marketing-card is-design-{{ design }} is-overlay-{{ overlay }}">
	{%- if link_url != blank -%}
		<a href="{{ link_url }}" class="is-marketing-card__link" aria-label="{{ heading | escape }}"></a>
	{%- endif -%}

	{%- if image -%}
		<div class="is-marketing-card__image">
			{%- render 'html-theme-media-image',
				image: image,
				alt: heading,
				w1: w1,
				w2: w2,
				w3: w3,
				w4: w4,
				w5: w5,
				sizes: img_sizes,
				image_loading: 'lazy',
				focus_x: focus_x,
				focus_y: focus_y
			-%}
		</div>
	{%- endif -%}

	<div class="is-marketing-card__overlay"></div>

	<div class="is-marketing-card__content">
		{%- if label != blank -%}
			<span class="is-marketing-card__label">{{ label }}</span>
		{%- endif -%}
		<h3 class="is-marketing-card__title">{{ heading }}</h3>
		{%- if text != blank -%}
			<div class="is-marketing-card__text">{{ text }}</div>
		{%- endif -%}
	</div>
</div>
