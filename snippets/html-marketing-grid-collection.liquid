{%- comment -%}
============================================================================
HTML-MARKETING-GRID-COLLECTION
============================================================================
Collection card with image and details for grid layouts.
Uses global .is-marketing-card utilities from theme-ux.scss.

PARAMETERS:
- collection       : Shopify collection object (required)
- show_description : Show collection description (default: true)
- design           : 'blue' | 'red' | 'green' (default: 'blue')
- block_id         : Unique block ID for styling
- columns_desktop  : Number of columns on desktop (default 3)
- columns_tablet   : Number of columns on tablet (default 2)
- columns_mobile   : Number of columns on mobile (default 1)
- columns_width    : Container width class (default 'is-align-wide')
- columns_gap      : Gap between grid items in em (default 1)

NOTES:
- Sizes = actual display size, srcset = 1x-3x for retina
- Quality default 70% via html-theme-media-image

DEPENDENCIES:
- html-theme-media-image snippet
- Global .is-marketing-card utilities from theme-ux.scss
============================================================================
{%- endcomment -%}

{%- liquid
	assign show_description = show_description | default: true
	assign design = design | default: 'blue'
	assign columns_desktop = columns_desktop | default: 3
	assign columns_tablet = columns_tablet | default: 2
	assign columns_mobile = columns_mobile | default: 1
	assign columns_width = columns_width | default: 'is-align-wide'
	assign columns_gap = columns_gap | default: 1
	
	comment
		Container width in pixels (match theme-ui.scss)
	endcomment
	case columns_width
		when 'is-align-narrow'
			assign container_px = 480
		when 'is-align-small'
			assign container_px = 640
		when 'is-align'
			assign container_px = 960
		when 'is-align-wide'
			assign container_px = 1280
		when 'is-align-full'
			assign container_px = 1600
		else
			assign container_px = 1280
	endcase
	
	comment
		Gap in pixels
	endcomment
	assign gap_px = columns_gap | times: 16
	
	comment
		Calculate actual display sizes per breakpoint
	endcomment
	assign desktop_gaps = columns_desktop | minus: 1 | times: gap_px
	assign desktop_available = container_px | minus: desktop_gaps
	assign desktop_image = desktop_available | divided_by: columns_desktop | round
	
	assign tablet_gaps = columns_tablet | minus: 1 | times: gap_px
	assign tablet_available = 960 | minus: tablet_gaps
	assign tablet_image = tablet_available | divided_by: columns_tablet | round
	
	assign mobile_gaps = columns_mobile | minus: 1 | times: gap_px
	assign mobile_available = 480 | minus: mobile_gaps
	assign mobile_image = mobile_available | divided_by: columns_mobile | round
	
	comment
		Build sizes attribute (actual display sizes, not Ã—3)
	endcomment
	assign img_sizes = '(min-width: 60em) ' | append: desktop_image | append: 'px, (min-width: 40em) ' | append: tablet_image | append: 'px, ' | append: mobile_image | append: 'px'
	
	comment
		Srcset widths based on desktop (largest display)
		Provides 1x, 1.5x, 2x, 2.5x, 3x for retina
	endcomment
	assign base = desktop_image
	if base < 200
		assign base = 200
	endif
	
	assign w1 = base | round
	assign w2 = base | times: 1.5 | round
	assign w3 = base | times: 2 | round
	assign w4 = base | times: 2.5 | round
	assign w5 = base | times: 3 | round
	if w5 > 2048
		assign w5 = 2048
	endif
	if w4 > 2048
		assign w4 = 2048
	endif
	
	comment
		Determine image source
	endcomment
	assign collection_image = collection.featured_image | default: collection.products.first.featured_media
-%}

<div class="is-marketing-card is-design-{{ design }}">
	{%- if collection -%}
		<a 
			href="{{ collection.url }}" 
			class="is-marketing-card__link"
			aria-label="{{ collection.title | escape }}"
		></a>
		
		<div class="is-marketing-card__image">
			{%- if collection_image -%}
				{%- render 'html-theme-media-image',
					image: collection_image,
					alt: collection_image.alt | default: collection.title,
					w1: w1,
					w2: w2,
					w3: w3,
					w4: w4,
					w5: w5,
					sizes: img_sizes,
					image_loading: 'lazy'
				-%}
			{%- endif -%}
		</div>
		
		<div class="is-marketing-card__content">
			<h3 class="is-marketing-card__title">
				{{ collection.title | escape }}
				{%- if collection.description == blank or show_description == false -%}
					<span class="marketing-grid-collection__arrow">
						{{- 'icon-arrow.svg' | inline_asset_content -}}
					</span>
				{%- endif -%}
			</h3>
			
			{%- if show_description and collection.description != blank -%}
				<p class="is-marketing-card__text">
					{{ collection.description | strip_html | truncatewords: 12 }}
					<span class="marketing-grid-collection__arrow">
						{{- 'icon-arrow.svg' | inline_asset_content -}}
					</span>
				</p>
			{%- endif -%}
		</div>
	{%- else -%}
		<div class="marketing-grid-collection__placeholder">
			<svg width="80" height="80" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
				<rect width="80" height="80" rx="8" fill="#e0e0e0"/>
				<rect x="12" y="12" width="24" height="24" rx="4" fill="#ccc"/>
				<rect x="40" y="12" width="28" height="28" rx="4" fill="#ccc"/>
				<rect x="12" y="40" width="28" height="28" rx="4" fill="#ccc"/>
				<rect x="44" y="44" width="24" height="24" rx="4" fill="#ccc"/>
			</svg>
			<p>Select a collection</p>
		</div>
	{%- endif -%}
</div>

<style>
.marketing-grid-collection__arrow {
	display: inline-flex;
	flex-shrink: 0;
	width: 20px;
	height: 20px;
	vertical-align: middle;
	margin-left: 0.25em;
}

.marketing-grid-collection__arrow svg {
	width: 100%;
	height: 100%;
}

.marketing-grid-collection__placeholder {
	display: flex;
	flex-direction: column;
	align-items: center;
	justify-content: center;
	height: 100%;
	background-color: #f5f5f5;
	color: #666;
	text-align: center;
	padding: 2rem;
}

.marketing-grid-collection__placeholder p {
	margin-top: 1rem;
	font-size: 0.875rem;
}
</style>
