{% comment %}
  Renders a product media gallery. Should be used with 'media-gallery.js'
  Also see 'product-media-modal'

  Accepts:
  - product: {Object} Product liquid object
  - variant_images: {Array} Product images associated with a variant
  - limit: {Number} (optional) When passed, limits the number of media items to render

  Usage:
  {% render 'product-media-gallery' %}
{% endcomment %}
<ul class="product-media-list" role="list" data-gallery="gallery-{{ section.id }}" >
  {%- if product.selected_or_first_available_variant.featured_media != null -%}
    {%- assign featured_media = product.selected_or_first_available_variant.featured_media -%}
    <li id="gallery-{{ section.id }}-{{ featured_media.id }}" class="product__media-item" data-media-id="{{ section.id }}-{{ featured_media.id }}" data-media-type="{{featured_media.media_type}}" >
      {%- assign media_position = 1 -%}
      {% render 'product-thumbnail',
        media: featured_media,
        media_count: media_count,
        position: media_position,
        desktop_layout: section.settings.gallery_layout,
        mobile_layout: section.settings.mobile_thumbnails,
        loop: section.settings.enable_video_looping,
        modal_id: section.id,
        xr_button: true,
        media_width: 50,
        media_fit: section.settings.media_fit,
        constrain_to_viewport: section.settings.constrain_to_viewport,
        lazy_load: false
      %}
    </li>
  {%- endif -%}
  {%- for media in product.media -%}
    {% if media_position >= limit
      or media_position >= 1
      and section.settings.hide_variants
      and variant_images contains media.src
    %}
      {% continue %}
    {% endif %}

    {%- unless media.id == product.selected_or_first_available_variant.featured_media.id -%}
      <li
        id="Slide-{{ section.id }}-{{ media.id }}"
        class="product__media-item grid__item slider__slide{% if single_media_visible %} product__media-item--single{% endif %}{% if product.selected_or_first_available_variant.featured_media == nil and forloop.index == 1 %} is-active{% endif %}{% if media.media_type != 'image' %} product__media-item--full{% endif %}{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--fade-in{% endif %}"
        data-media-id="{{ section.id }}-{{ media.id }}" data-media-type="{{media.media_type}}" 
      >
        {%- liquid
          assign media_position = media_position | default: 0 | plus: 1
          assign lazy_load = false
          if media_position > 1
            assign lazy_load = true
          endif
        -%}
        {% render 'product-thumbnail',
          media: media,
          media_count: media_count,
          position: media_position,
          desktop_layout: section.settings.gallery_layout,
          mobile_layout: section.settings.mobile_thumbnails,
          loop: section.settings.enable_video_looping,
          modal_id: section.id,
          xr_button: true,
          media_width: media_width,
          media_fit: section.settings.media_fit,
          constrain_to_viewport: section.settings.constrain_to_viewport,
          lazy_load: lazy_load
        %}
      </li>
    {%- endunless -%}
  {%- endfor -%}
</ul>
{{ 'component-deferred-media.css' | asset_url | stylesheet_tag }}