{% comment %}
  HTML Marketing Grid Component: Video Item
  Video player (YouTube/Vimeo) with cover image for grid layouts
  
  Parameters:
  - video_url: {String} YouTube or Vimeo URL (required)
  - cover_image: {Object} Cover/poster image (optional)
  - description: {String} Video description for accessibility (optional)
  - design: {String} blue | red | green - default: blue
  - block_id: {String} Unique block ID for styling
  
  Usage:
  {% render 'html-marketing-grid-video',
    video_url: block.settings.video_url,
    cover_image: block.settings.cover_image,
    description: block.settings.description,
    design: block.settings.design,
    block_id: block.id
  %}
{% endcomment %}

{%- liquid
  assign description = description | default: 'Video'
  assign design = design | default: 'blue'
  
  if video_url
    if video_url.type == 'youtube'
      assign video_id = video_url.id
      assign video_type = 'youtube'
    elsif video_url.type == 'vimeo'
      assign video_id = video_url.id
      assign video_type = 'vimeo'
    endif
  endif
  
  assign unique_id = 'video-' | append: block_id
-%}

<div class="marketing-grid-video is-design-{{ design }}">
  {%- if video_id -%}
    {%- if cover_image != blank -%}
      <div class="marketing-grid-video__cover" id="cover-{{ unique_id }}">
        {%- capture sizes -%}
          (min-width: 990px) 33vw, (min-width: 750px) 50vw, 100vw
        {%- endcapture -%}
        {{
          cover_image
          | image_url: width: 1200
          | image_tag: 
            sizes: sizes, 
            widths: '360, 550, 720, 990, 1100, 1200',
            loading: 'lazy',
            class: 'marketing-grid-video__cover-image'
        }}
        <button 
          class="marketing-grid-video__play-button" 
          aria-label="Play video"
          onclick="document.getElementById('cover-{{ unique_id }}').style.display='none'; document.getElementById('iframe-{{ unique_id }}').src += '&autoplay=1';"
        >
          <span class="marketing-grid-video__play-icon">
            {{- 'icon-play.svg' | inline_asset_content -}}
          </span>
        </button>
      </div>
    {%- endif -%}
    
    <div class="marketing-grid-video__player">
      {%- if video_type == 'youtube' -%}
        <iframe
          id="iframe-{{ unique_id }}"
          src="https://www.youtube.com/embed/{{ video_id }}?enablejsapi=1&rel=0"
          class="marketing-grid-video__iframe"
          allow="autoplay; encrypted-media"
          allowfullscreen
          title="{{ description | escape }}"
          loading="lazy"
        ></iframe>
      {%- elsif video_type == 'vimeo' -%}
        <iframe
          id="iframe-{{ unique_id }}"
          src="https://player.vimeo.com/video/{{ video_id }}"
          class="marketing-grid-video__iframe"
          allow="autoplay; fullscreen; picture-in-picture"
          allowfullscreen
          title="{{ description | escape }}"
          loading="lazy"
        ></iframe>
      {%- endif -%}
    </div>
  {%- else -%}
    <div class="marketing-grid-video__placeholder">
      <svg width="80" height="80" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="40" cy="40" r="40" fill="#e0e0e0"/>
        <path d="M32 26L54 40L32 54V26Z" fill="#999"/>
      </svg>
      <p>Add a video URL</p>
    </div>
  {%- endif -%}
</div>

<style>
  .marketing-grid-video {
    position: relative;
    overflow: hidden;
    background-color: #000;
  }
  
  .marketing-grid-video__player {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }
  
  .marketing-grid-video__iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
  }
  
  /* Cover image */
  .marketing-grid-video__cover {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 2;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .marketing-grid-video__cover-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  /* Play button */
  .marketing-grid-video__play-button {
    position: relative;
    z-index: 1;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
    width: 80px;
    height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.2s ease;
  }
  
  .marketing-grid-video__play-button:hover {
    transform: scale(1.1);
  }
  
  .marketing-grid-video__play-icon {
    display: block;
    width: 80px;
    height: 80px;
    background-color: rgba(255, 255, 255, 0.95);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  }
  
  .marketing-grid-video__play-icon svg {
    width: 32px;
    height: 32px;
    margin-left: 4px;
  }
  
  /* Placeholder */
  .marketing-grid-video__placeholder {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background-color: #f5f5f5;
    color: #666;
    text-align: center;
    padding: 2rem;
  }
  
  .marketing-grid-video__placeholder p {
    margin-top: 1rem;
    font-size: 0.875rem;
  }
  
  /* Design variants - add subtle overlay on hover */
  .marketing-grid-video.is-design-blue .marketing-grid-video__cover::after,
  .marketing-grid-video.is-design-red .marketing-grid-video__cover::after,
  .marketing-grid-video.is-design-green .marketing-grid-video__cover::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
  }
  
  .marketing-grid-video.is-design-blue .marketing-grid-video__cover::after {
    background: linear-gradient(135deg, rgba(30, 64, 175, 0.2) 0%, transparent 100%);
  }
  
  .marketing-grid-video.is-design-red .marketing-grid-video__cover::after {
    background: linear-gradient(135deg, rgba(220, 38, 38, 0.2) 0%, transparent 100%);
  }
  
  .marketing-grid-video.is-design-green .marketing-grid-video__cover::after {
    background: linear-gradient(135deg, rgba(22, 163, 74, 0.2) 0%, transparent 100%);
  }
  
  .marketing-grid-video__cover:hover::after {
    opacity: 1;
  }
  
  /* Responsive */
  @media (max-width: 749px) {
    .marketing-grid-video__play-button {
      width: 60px;
      height: 60px;
    }
    
    .marketing-grid-video__play-icon {
      width: 60px;
      height: 60px;
    }
    
    .marketing-grid-video__play-icon svg {
      width: 24px;
      height: 24px;
    }
  }
</style>
