{% comment %}
  HTML Marketing Component: Video
  Video player (background or standard)
  
  Parameters:
  - video_url: {String} YouTube or Vimeo URL (required)
  - cover_image: {Object} Cover/poster image
  - type: {String} standard | background - default: standard
  - autoplay: {Boolean} Auto-play video - default: false (ignored if type is standard)
  - loop: {Boolean} Loop video - default: false
  - muted: {Boolean} Mute video - default: true (for background type)
  - controls: {Boolean} Show controls - default: true (for standard type)
  - width: {String} narrow | medium | wide | full - default: medium
  - aspect_ratio: {String} 16-9 | 4-3 | 1-1 | 2-3 | 3-2 - default: 16-9
  - focus_x: {Number} 0-100 - horizontal focus point for cover image - default: 50
  - focus_y: {Number} 0-100 - vertical focus point for cover image - default: 50
{% endcomment %}

{%- liquid
  assign video_url = video_url | default: ''
  assign type = type | default: 'standard'
  assign autoplay = autoplay | default: false
  assign loop = loop | default: false
  assign muted = muted | default: true
  assign controls = controls | default: true
  assign width = width | default: 'medium'
  assign aspect_ratio = aspect_ratio | default: '16-9'
  assign focus_x = focus_x | default: 50
  assign focus_y = focus_y | default: 50
  
  if video_url != blank
    assign video_id = ''
    assign video_type = ''
    
    if video_url contains 'youtube.com' or video_url contains 'youtu.be'
      assign video_type = 'youtube'
      if video_url contains 'youtu.be/'
        assign video_id = video_url | split: 'youtu.be/' | last | split: '?' | first
      elsif video_url contains 'watch?v='
        assign video_id = video_url | split: 'watch?v=' | last | split: '&' | first
      endif
    elsif video_url contains 'vimeo.com'
      assign video_type = 'vimeo'
      assign video_id = video_url | split: 'vimeo.com/' | last | split: '/' | first
    endif
  endif
-%}

<div class="marketing-video marketing-video--{{ type }} marketing-video--{{ width }} marketing-video--ratio-{{ aspect_ratio }}">
  <div class="marketing-video__wrapper">
    {%- if video_id != blank -%}
      {%- if cover_image and type == 'standard' -%}
        <div class="marketing-video__cover" id="video-cover-{{ video_id }}">
          <img
            src="{{ cover_image | image_url: width: 1200 }}"
            alt="{{ cover_image.alt | escape }}"
            width="{{ cover_image.width }}"
            height="{{ cover_image.height }}"
            loading="lazy"
            style="object-position: {{ focus_x }}% {{ focus_y }}%;"
          />
          <button 
            class="marketing-video__play-button" 
            aria-label="Play video"
            onclick="document.getElementById('video-cover-{{ video_id }}').style.display='none'; document.getElementById('video-player-{{ video_id }}').src += '&autoplay=1';"
          >
            <svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="30" cy="30" r="30" fill="white" fill-opacity="0.9"/>
              <path d="M25 20L40 30L25 40V20Z" fill="black"/>
            </svg>
          </button>
        </div>
      {%- endif -%}
      
      <div class="marketing-video__player" id="video-player-wrapper-{{ video_id }}">
        {%- liquid
          assign iframe_params = ''
          
          if video_type == 'youtube'
            if autoplay and type == 'background'
              assign iframe_params = iframe_params | append: '&autoplay=1'
            endif
            if loop
              assign iframe_params = iframe_params | append: '&loop=1&playlist=' | append: video_id
            endif
            if muted or type == 'background'
              assign iframe_params = iframe_params | append: '&mute=1'
            endif
            if controls == false or type == 'background'
              assign iframe_params = iframe_params | append: '&controls=0'
            endif
            if type == 'background'
              assign iframe_params = iframe_params | append: '&playsinline=1&disablekb=1&modestbranding=1'
            endif
          elsif video_type == 'vimeo'
            if autoplay and type == 'background'
              assign iframe_params = iframe_params | append: '&autoplay=1'
            endif
            if loop
              assign iframe_params = iframe_params | append: '&loop=1'
            endif
            if muted or type == 'background'
              assign iframe_params = iframe_params | append: '&muted=1'
            endif
            if type == 'background'
              assign iframe_params = iframe_params | append: '&background=1'
            endif
          endif
        -%}
        
        {%- if video_type == 'youtube' -%}
          <iframe
            id="video-player-{{ video_id }}"
            src="https://www.youtube.com/embed/{{ video_id }}?rel=0{{ iframe_params }}"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen
            title="YouTube video player"
          ></iframe>
        {%- elsif video_type == 'vimeo' -%}
          <iframe
            id="video-player-{{ video_id }}"
            src="https://player.vimeo.com/video/{{ video_id }}?{{ iframe_params }}"
            frameborder="0"
            allow="autoplay; fullscreen; picture-in-picture"
            allowfullscreen
            title="Vimeo video player"
          ></iframe>
        {%- endif -%}
      </div>
    {%- else -%}
      <div class="marketing-video__placeholder">
        <svg width="120" height="120" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="60" cy="60" r="60" fill="#e0e0e0"/>
          <path d="M50 40L80 60L50 80V40Z" fill="#999"/>
        </svg>
        <p>Add a video URL</p>
      </div>
    {%- endif -%}
  </div>
</div>

<style>
  .marketing-video {
    padding: 1.5rem 0;
  }
  
  .marketing-video__wrapper {
    margin: 0 auto;
    position: relative;
  }
  
  /* Width variations */
  .marketing-video--narrow .marketing-video__wrapper {
    max-width: 600px;
  }
  
  .marketing-video--medium .marketing-video__wrapper {
    max-width: 900px;
  }
  
  .marketing-video--wide .marketing-video__wrapper {
    max-width: 1200px;
  }
  
  .marketing-video--full .marketing-video__wrapper {
    max-width: 100%;
  }
  
  /* Aspect ratios */
  .marketing-video--ratio-16-9 .marketing-video__wrapper {
    aspect-ratio: 16 / 9;
  }
  
  .marketing-video--ratio-4-3 .marketing-video__wrapper {
    aspect-ratio: 4 / 3;
  }
  
  .marketing-video--ratio-1-1 .marketing-video__wrapper {
    aspect-ratio: 1 / 1;
  }
  
  .marketing-video--ratio-2-3 .marketing-video__wrapper {
    aspect-ratio: 2 / 3;
  }
  
  .marketing-video--ratio-3-2 .marketing-video__wrapper {
    aspect-ratio: 3 / 2;
  }
  
  /* Player */
  .marketing-video__player iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }
  
  /* Background type */
  .marketing-video--background {
    padding: 0;
  }
  
  .marketing-video--background .marketing-video__wrapper {
    max-width: 100%;
  }
  
  .marketing-video--background .marketing-video__player iframe {
    pointer-events: none;
  }
  
  /* Cover image */
  .marketing-video__cover {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 2;
    cursor: pointer;
  }
  
  .marketing-video__cover img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  /* Play button */
  .marketing-video__play-button {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: none;
    border: none;
    cursor: pointer;
    transition: transform 0.2s ease;
    padding: 0;
  }
  
  .marketing-video__play-button:hover {
    transform: translate(-50%, -50%) scale(1.1);
  }
  
  .marketing-video__play-button svg {
    filter: drop-shadow(0 2px 8px rgba(0,0,0,0.3));
  }
  
  /* Placeholder */
  .marketing-video__placeholder {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background-color: #f5f5f5;
    padding: 3rem;
    text-align: center;
    min-height: 400px;
  }
  
  .marketing-video__placeholder p {
    margin-top: 1rem;
    color: #666;
  }
</style>
